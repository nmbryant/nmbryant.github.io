var K=function(){"use strict";const a="POST",b="PUT",c="PS_SEND",d="PS_EMAILS",e="PS_LOAD",f="PS_SAVE",g="?cmd=";var h=200;const i="[K._sendRequest] ",j={name:"Knecht",major:2,minor:1,revision:"0a",server:"http://perlenspiel.cs.wpi.edu:8080/",timeout:10},k=function(a){var b;return b=typeof a,"number"===b?isNaN(a)?b="NaN":isFinite(a)||(b="Infinity"):"object"===b&&(a?a instanceof Array&&(b="array"):b="null"),b},l=function(a){return!0===a||!1===a?a:null!==a&&void 0!==a&&("number"===k(a)?0!==a:K.ERROR)},m=["January","February","March","April","May","June","July","August","September","October","November","December"],n=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],p=["SUN","MON","TUE","WED","THU","FRI","SAT"],q=function(){var a,b,c,d,e,f,g,h;return a=new Date,b={time:a.getTime(),year:a.getFullYear(),month:a.getMonth(),date:a.getDate(),day:a.getDay(),hour24:a.getHours(),hour:0,minute:a.getMinutes(),second:a.getSeconds(),millisecond:a.getMilliseconds(),zone:a.getTimezoneOffset(),monthName:"",monthShort:"",dayName:"",dayShort:"",am_pm:"",monthStr:"",dayStr:"",minuteStr:"",secondStr:"",millisecondStr:"",timeStr:"",formal:"",abbrev:"",timestamp:""},b.monthName=m[b.month],b.monthShort=n[b.month],b.dayName=o[b.day],b.dayShort=p[b.day],b.hour=b.hour24+1,b.hour24>11?(b.am_pm="PM",b.hour24>12&&(b.hour=b.hour24-12)):b.am_pm="AM",c=b.month<10?"0"+b.month:b.month.toString(),b.monthStr=c,d=b.date<10?"0"+b.date:b.date.toString(),b.dateStr=d,e=b.hour<10?"0"+b.hour:b.hour.toString(),b.hourStr=e,f=b.minute<10?"0"+b.minute:b.minute.toString(),b.minuteStr=f,g=b.second<10?"0"+b.second:b.second.toString(),b.secondStr=g,h=b.millisecond<10?"00"+b.millisecond:b.millisecond<100?"0"+b.millisecond:b.millisecond.toString(),b.millisecondStr=h,b.timeStr=e+":"+f+":"+g+"+"+h,b.formal=b.dayName+" "+d+" "+b.monthName+" "+b.year+" "+b.timeStr+" "+b.am_pm,b.abbrev=b.dayShort+" "+d+" "+b.monthShort+" "+b.year+" "+b.timeStr+" "+b.am_pm,b.timestamp=b.dayShort+"_"+d+"_"+b.monthShort+"_"+b.year+"_"+e+"_"+f+"_"+g+"_"+h+b.am_pm,b.hours24=b.hour24,b.hours=b.hour,b.minutes=b.minute,b.seconds=b.second,b.milliseconds=b.millisecond,b.string=b.abbrev,b},r=function(a,b){var c,d,e;return c="ERROR @ "+a,d=b,void 0===d&&(e=q(),d=e.timestamp),console.log(c),{error:c,timestamp:d,data:null}},s=function(a){var b,c,d,e;for(b=a.split(""),c=b.length,d=0;d<c;d+=1)"."!==(e=b[d])&&"$"!==e&&"@"!==e||(b[d]="_");return b.join("")},t=function(a,b,c,d,e,f){var g,k,m,n,o,p;if(g=q(),(k=l(f))===K.ERROR)return e(r(i+"sync argument invalid",g.timestamp)),!1;try{m=new XMLHttpRequest}catch(a){return e(r(i+"XMLHttpRequest() init ["+a.message+"]",g.timestamp)),!1}n=encodeURI(j.server)+a+b;try{m.open(c,n,k)}catch(a){return e(r(i+"XMLHttpRequest.open() @ "+n+" ("+c+"), sync="+!k+" ["+a.message+"]",g.timestamp)),!1}o=function(){var a,b,c;if(a=m.readyState,b=m.status,a===m.DONE&&b===h){try{c=JSON.parse(m.responseText)}catch(a){return c=r(i+"JSON.parse( request.responseText ) ["+a.message+"]"),e(c),!1}e(c)}return!0},k||(m.onreadystatechange=o),d.timestamp||(d.timestamp=g.timestamp),d.timeout||(d.timeout=j.timeout);try{p=JSON.stringify(d)}catch(a){return e(r(i+"JSON.stringify( data ) ["+a.message+"]",g.timestamp)),!1}console.log("JSON: "+p);try{m.send(p)}catch(a){return e(r(i+"request.send( json ) ["+a.message+"]",g.timestamp)),!1}return!k||o()};return{ERROR:"K.ERROR",OK:"K.OK",VERIFIED:"K.VERIFIED",sendData:function(b,d,e,f,h){var i,j;return e&&"object"===k(e)?f&&"function"==typeof f?(i=g+encodeURIComponent(c),j={data:{email:b,username:s(b),password:d,content:e}},t(K.PS.PATH,i,a,j,f,h)?K.OK:K.ERROR):"Callback function invalid":"Content object invalid"},init:function(){return j},PS:{PATH:"ps",USERS:{njblackwood:1,nbloniarz:1,srbriggs:1,bhsostek:1,aabuffum:1,jfu3:1,dlgiangrave:1,csgriffin:1,jguo2:1,wahartman:1,aihorton:1,bhuchley:1,kliu4:1,wblucca:1,prmalone2:1,jamarciano:1,fmo:1,kmolguin:1,sgredding:1,coreynolds:1,jmriley:1,kqsavell:1,grsolbeck:1,svwoolf:1,player:1,bmoriarty:1},BCC:null,DOMAIN:"@wpi.edu",DOMAIN_CS:"@cs.wpi.edu",sendVerifiedEmails:function(b,c,e,f){var h,i;return b&&"array"===k(b)?c&&"object"===k(c)?e&&"function"==typeof e?(h=g+encodeURIComponent(d),c.bcc=K.PS.BCC,i={data:{emails:b,content:c}},t(K.PS.PATH,h,a,i,e,f)?K.OK:K.ERROR):"Callback function invalid":"Content object invalid":"Emails array invalid"},load:function(a,c){var d,f;return c&&"function"==typeof c?(d=g+encodeURIComponent(e),f={username:a},t(K.PS.PATH,d,b,f,c,!1)?K.OK:K.ERROR):"Callback function invalid"},save:function(a,c,d){var e,h;return d&&"function"==typeof d?(e=g+encodeURIComponent(f),h={username:a,data:c},t(K.PS.PATH,e,b,h,d,!1)?K.OK:K.ERROR):"Callback function invalid"},addSuffix:function(a){return"claypool"===a?a+K.PS.DOMAIN_CS:a+K.PS.DOMAIN},init:function(){return j}}}}();

var PS;!function(){"use strict";function Qa(a){var b;return b=typeof a,"number"===b?isNaN(a)?b="NaN":isFinite(a)||(b="Infinity"):"object"===b&&(a?a instanceof Array&&(b="array"):b="null"),b}function Ra(a){return!0===a||!1===a?a:void 0!==a&&null!==a&&0!==a&&PS.ERROR}function Sa(a,b,c,d){var e,f;return e=a,!0!==e&&!1!==e&&(null===e?e=!1:e===PS.CURRENT?e=b:e===PS.DEFAULT?e=c:(f=Qa(e),e="undefined"===f?d:"number"===f?0!==e:PS.ERROR)),e}function Ta(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,a.preventDefault(),!1}function Ua(){var a,b,c,d,e,f;for(a=[],b=arguments.length,c=0;c<b;c+=1)d=arguments[c],e=d-65536,f=d>65535?[55296+(e>>10),56320+(1023&e)]:[d],a.push(String.fromCharCode.apply(null,f));return a.join("")}function Ya(a,b,c){var d;d=a.a*(1-b.a),c.r=Math.floor(b.r*b.a+a.r*d),c.g=Math.floor(b.g*b.a+a.g*d),c.b=Math.floor(b.b*b.a+a.b*d)}function $a(a,b){var c;return c=b.a,c<1?(Za.rgb=a.rgb,Za.r=a.r,Za.g=a.g,Za.b=a.b,Za.a=a.a,Za.str=a.str):c<255?(Va.r=a.r,Va.g=a.g,Va.b=a.b,Va.a=1,Wa.r=b.r,Wa.g=b.g,Wa.b=b.b,Wa.a=O[c],Ya(Va,Wa,Za),Za.a=1,Za.rgb=Za.r*u+Za.g*v+Za.b,Za.str=J[Za.r]+L[Za.g]+M[Za.b]):(Za.rgb=b.rgb,Za.r=b.r,Za.g=b.g,Za.b=b.b,Za.a=b.a,Za.str=b.str),Za}function _a(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(g=U.context,h=U.bead_size,i=a.left,j=a.top,k=h,l=h,!a.visible)return g.fillStyle=f.str,void g.fillRect(i,j,k,l);o=a.size<h,p=a.radius,q=a.planes[0].color.a,m=a.border,r=c.a,s=null,(o||p>0||q<255||m.width>0&&r<255)&&(s=$a(f,e),g.fillStyle=s.str,g.fillRect(i,j,k,l),o&&(i+=a.margin,j+=a.margin,k=a.size,l=a.size)),u=Math.floor(k*p/100),v=0,m.width>0&&(r>0&&(g.fillStyle=c.str,p<1?(t=m.top,t>0&&g.fillRect(i,j,k,t),t=m.bottom,t>0&&g.fillRect(i,j+l-t,k,t),t=m.left,t>0&&g.fillRect(i,j,t,l),(t=m.right)>0&&g.fillRect(i+k-t,j,t,l)):p<50?g.fillRoundedRect(i+v,j+v,k-v,l-v,u):g.fillCircle(i+v,j+v,k-v,l-v)),i+=m.left,j+=m.top,k-=m.left+m.right,l-=m.top+m.bottom,r>0&&p>0&&(s||(s=$a(f,e)),g.fillStyle=s.str,p<50?g.fillRoundedRect(i+v,j+v,k-v,l-v,u):g.fillCircle(i+v,j+v,k-v,l-v))),g.fillStyle=b.str,p<1?g.fillRect(i,j,k,l):p<50?g.fillRoundedRect(i+v,j+v,k-v,l-v,u):g.fillCircle(i+v,j+v,k-v,l-v),n=a.glyph,n.code>0&&d.a>0&&(U.context.font=n.font,g.fillStyle=d.str,g.fillText(n.str,a.left+n.x,a.top+n.y))}function ab(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;for(d=b.r,e=b.g,f=b.b,g=b.a,h=a.planes,i=h.length,j=0;j<i;j+=1)l=h[j],k=l.color,m=k.r,n=k.g,o=k.b,(p=k.a)>0&&(p<255?(Va.r=d,Va.g=e,Va.b=f,Va.a=1,Wa.r=m,Wa.g=n,Wa.b=o,Wa.a=O[p],Ya(Va,Wa,Xa),d=Xa.r,e=Xa.g,f=Xa.b):(d=m,e=n,f=o),g=p);m=d,n=e,o=f,p=g,c.rgb=m*u+n*v+o,c.r=m,c.g=n,c.b=o,c.a=p,c.str=J[m]+L[n]+M[o]}function cb(a){var b,c,d,e,f;for(b=a.str,c=U.canvas,c.style.backgroundColor=b,document.body.style.backgroundColor=b,W.statusP.style.backgroundColor=b,W.inputP.style.backgroundColor=b,ka.style.backgroundColor=b,d=0;d<U.count;d+=1)e=V[d],f=$a(a,e.bgColor),ab(e,f,bb),_a(e,bb,e.border.color,e.glyph.color,e.bgColor,a)}function db(a){var b,c,d;b=a.r>127?0:255,c=a.g>127?0:255,d=a.b>127?0:255,ka.style.color=J[b]+L[c]+M[d]}function eb(a){U.canvas.style.boxShadow=U.shadow.params+a.str}function fb(a){W.statusP.style.color=a.str,W.inputP.style.color=a.str}function gb(a,b){var c;c=V[b],_a(c,a,c.border.color,c.glyph.color,c.bgColor,U.color)}function hb(a,b){var c;c=V[b],_a(c,c.color,a,c.glyph.color,c.bgColor,U.color)}function ib(a,b){var c;c=V[b],_a(c,c.color,c.border.color,a,c.bgColor,U.color)}function jb(a){a.dirty=!0,X=!0}function kb(){var a,b,c;if(Y=0,X){for(a=U.count,b=0;b<a;b+=1)c=V[b],c.dirty&&(c.dirty=!1,_a(c,c.color,c.border.color,c.glyph.color,c.bgColor,U.color),Y+=1);X=!1}}function lb(){Ka||(Ia.style.display="inline",Ja.value="",Ka=!0,La=!1)}function mb(a){("string"!=typeof a||a.length<1)&&(a="???"),PS.debug("WARNING: "+a+"\n")}function pb(a){var b,c,d;return b="",-1!==a.search(".js")?(c=a.lastIndexOf("/")+1,d=a.substr(c).replace(/^[\s\(\)]+|[\s\(\)]+$/g,""),3===d.split(":").length&&(d=d.substr(0,d.lastIndexOf(":"))),""!==d&&(b+="    "+d+"\n")):ob&&-1!==a.search(".htm")&&(b+="\n"+a),b}function qb(a){var b,c,d,e;if(console&&console.log&&console.log(a),!a.split)return a;for(b=a.split("\n"),e="",c=b.length,d=0;d<c;d+=1)e+=pb(b[d]);return e}function rb(){ma&&(PS.timerStop(ma),ma=null)}function sb(a){ka.style.opacity="1.0",ka.innerHTML=la=a}function tb(a,b){var c;return ea=!1,(!a||"string"!=typeof a||a.length<1)&&(a="???"),c="ERROR: "+a,rb(),sb(c),c+="\n",nb&&b&&b.stack&&(c+=qb(b.stack)+"\n"),PS.debug(c),Ma&&PS.audioPlay(H.audio.error_sound,{path:H.audio.path}),PS.ERROR}function ub(a){try{throw new Error("!")}catch(b){return tb(a,b)}}function vb(){var a;a=document.getElementById(b),a.scrollTop=a.scrollHeight}function wb(){ia=[],ja=0}function xb(a){a.active=!1,a.kill=!1,a.r=0,a.g=0,a.b=0,a.rgb=null,a.tr=0,a.tg=0,a.tb=0,a.trgb=0,a.tstr=null,a.step=0,a.rate=0,a.onStep=null,a.onEnd=null,a.params=null,a.frames=[]}function yb(a,b,c){var d;return d={element:a,exec:b,execEnd:c},xb(d),d}function zb(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,w,x,y;if(a.step=0,a.frames.length=0,b!==f||c!==g||d!==h||e!==i){a.tr=f,a.tg=g,a.tb=h,a.ta=i,a.trgb=f*u+g*v+h,a.tstr=J[f]+L[g]+L[h]+N[i],j=b,k=c,l=d,m=e,r=b>f?-(b-f):f-b,s=c>g?-(c-g):g-c,t=d>h?-(d-h):h-d,w=e>i?-(e-i):i-e,n=a.rate<B?1:Math.ceil(a.rate/B),o=100/n,p=0;do{if(x=!1,q={},p+=o,p>=100?(q.r=f,q.g=g,q.b=h,q.a=i):(j!==f&&(y=p*r/100,j=b+y,j=Math.round(j),x=!0),q.r=j,k!==g&&(y=p*s/100,k=c+y,k=Math.round(k),x=!0),q.g=k,l!==h&&(y=p*t/100,l=d+y,l=Math.round(l),x=!0),q.b=l,m!==i&&(y=p*w/100,m=e+y,m=Math.round(m),x=!0),q.a=m),q.rgb=q.r*u+q.g*v+q.b,q.str=J[q.r]+L[q.g]+L[q.b]+N[q.a],a.frames.push(q),!x)return}while(p<100)}}function Ab(a,b,c,d,e,f,g,h,i){zb(a,b,c,d,e,f,g,h,i),a.frames.length>0&&(a.kill=!1,a.active=!0,ia.push(a))}function Bb(a,b,c,d,e){var f,g,h,i;f=a.active,a.active=!1,g=a.frames.length,g>0&&(h=a.step,h>=g&&(h=g-1),i=a.frames[h],zb(a,i.r,i.g,i.b,i.a,b,c,d,e)),a.frames.length>0&&(a.active=f)}function Cb(){ga=[],ha=0}function Eb(){var a,b,c,d,e,f,g,h,i,j,k,l,m;if(a="[_tick] ",fa+=1,b=!1,(ja+=1)>=B)for(ja=0,c=ia.length,d=0;d<c;)if(e=ia[d],g=e.frames.length,e.kill)ia.splice(d,1),c-=1;else if(e.active){if(f=e.frames[e.step],k=e.onStep){m=[g,e.step,f.rgb],e.params&&(m=m.concat(e.params));try{j=k.apply(x,m),!1!==j&&null!==j||(e.step=g-1,f=e.frames[e.step]),b=!0}catch(b){return void tb(a+"fader .onStep failed ["+b.message+"]",b)}}if(e.exec)try{e.exec(f,e.element)}catch(b){return void tb(a+"fader .exec failed ["+b.message+"]",b)}if(e.step+=1,e.step>=g){if(e.active=!1,e.step=0,e.frames.length=0,e.execEnd)try{e.execEnd(f,e.element)}catch(b){return void tb(a+"fader .execEnd failed ["+b.message+"]",b)}if(k=e.onEnd){m=e.params,m||(m=[]);try{k.apply(x,m),b=!0}catch(b){return void tb(a+"fader .onEnd failed ["+b.message+"]",b)}}ia.splice(d,1),c-=1}else d+=1}else d+=1;if(c=ua.length,ya&&c>0)if(za>0)za-=1;else if(za=Aa,PS.keyDown)for(d=0;d<c;d+=1)if(h=ua[d]){Db.time=fa;try{PS.keyDown(h,va,wa,Db),b=!0}catch(b){return void tb(a+"Key repeat failed ["+b.message+"]",b)}}if((c=ga.length)>0)for(d=0;d<c;){if(i=ga[d],l=i.id,i.count-=1,i.count<1){i.count=i.delay;try{j=i.exec.apply(x,i.arglist),b=!0}catch(b){j=tb(a+"Timed function failed ["+b.message+"]",b)}j===PS.ERROR&&PS.timerStop(l),c=ga.length}c>0&&(i=ga[d])&&i.id===l&&(d+=1)}b&&kb()}function Fb(){na>0?na-=1:(oa-=.05,oa<=0&&(PS.timerStop(ma),ma=null,oa=0,la=""),ka.style.opacity=oa.toString())}function Gb(a){rb(),na=50,oa=1,sb(a.toString()),ma=PS.timerStart(6,Fb)}function Ib(a){var b,c,d,e,f,g,h,i,j,k,m;b=$a(U.color,a.bgColor),ab(a,b,Hb),c=Hb.rgb,e=Hb.r,f=Hb.g,g=Hb.b,h=Hb.a,d=a.color,i=d.r,j=d.g,k=d.b,d.a,d.rgb=c,d.r=e,d.g=f,d.b=g,d.a=h,d.str=Hb.str,a.visible&&(m=a.fader,m.rate>0?null!==m.rgb?Ab(m,m.r,m.g,m.b,255,e,f,g,255):m.active?Bb(m,e,f,g,255):Ab(m,i,j,k,255,e,f,g,255):jb(a))}function Jb(a,b,c,d,e){var f,g,h,i;if((f=c)!==PS.CURRENT&&f!==PS.DEFAULT)if("undefined"===(i=Qa(f)))f=PS.CURRENT;else{if("number"!==i)return ub(a+"red value invalid");f=Math.floor(f),f<0?f=0:f>255&&(f=255)}if((g=d)!==PS.CURRENT&&g!==PS.DEFAULT)if("undefined"===(i=Qa(g)))g=PS.CURRENT;else{if("number"!==i)return ub(a+"green value invalid");g=Math.floor(g),g<0?g=0:g>255&&(g=255)}if((h=e)!==PS.CURRENT&&h!==PS.DEFAULT)if("undefined"===(i=Qa(h)))h=PS.CURRENT;else{if("number"!==i)return ub(a+"blue value invalid");h=Math.floor(h),h<0?h=0:h>255&&(h=255)}return b.rgb=null,b.r=f,b.g=g,b.b=h,PS.DONE}function Kb(a,b){var c,d,e,f,g,h;c=Math.floor(b),c<1?c=d=f=h=0:c>=16777215?(c=16777215,d=f=h=255):(d=c/u,d=Math.floor(d),e=d*u,f=(c-e)/v,f=Math.floor(f),g=f*v,h=c-e-g),a.rgb=c,a.r=d,a.g=f,a.b=h}function Mb(a,b,c,d){var e,f,h;if(e=Lb,e.rgb=0,e.r=null,e.g=null,e.b=null,e.str="",f=Qa(b),void 0!==c||void 0!==d){if("number"!==f&&"undefined"!==f&&b!==PS.CURRENT&&b!==PS.DEFAULT)return ub("array"===f?a+"Extraneous arguments after color array":"object"===f?a+"Extraneous arguments after color object":a+"red argument invalid");if(Jb(a,e,b,c,d)===PS.ERROR)return PS.ERROR}else if("number"===f)Kb(e,b);else if("array"===f){if(b.length<1)e.rgb=PS.CURRENT;else if(Jb(a,e,b[0],b[1],b[2])===PS.ERROR)return PS.ERROR}else if("object"===f)if(h=b.rgb,"undefined"===(f=Qa(h))||null===h){if(Jb(a,e,b.r,b.g,b.b)===PS.ERROR)return PS.ERROR}else if("number"===f)Kb(e,h);else{if(h!==PS.CURRENT&&h!==PS.DEFAULT)return ub(a+".rgb property invalid");e.rgb=h}else if("undefined"===f||b===PS.CURRENT)e.rgb=PS.CURRENT;else{if(b!==PS.DEFAULT)return ub(a+"color argument invalid");e.rgb=PS.DEFAULT}return e}function Nb(a){var b,c,d,e;b=U.bead_size,a.glyph.x=Math.round(b/2),d=a.glyph.scale,c=d<100?Math.round(b*d/100):b,a.glyph.size=e=Math.round(c/2),a.glyph.font=e+"px 'droid'",a.glyph.y=Math.round((b-e)/2+e/2)}function Ob(a){a.dirty=!0,a.active=!0,a.visible=!0,a.planes=null,a.color={r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},a.bgColor={r:255,g:255,b:255,a:0,rgb:16777215,str:"rgba(255,255,255,0)"},a.radius=0,a.scale=100,a.minimum=H.bead.minimum,a.data=0,a.exec=null,a.border={width:1,equal:!0,top:1,left:1,bottom:1,right:1,color:{r:128,g:128,b:128,a:255,rgb:8421504,str:"rgba(128,128,128,1)"}},a.glyph={str:"",code:0,scale:100,size:0,x:0,y:0,font:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}},a.planes=[{height:0,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"}}],Nb(a),xb(a.fader),xb(a.borderFader),xb(a.glyphFader)}function Pb(a,b){var c,d,e,f,g,h;if(c=a.planes,b<1)return d=c[0],d.color;for(e=c.length,f=1;f<e;f+=1)if(d=c[f],d.height===b)return d.color;if(h=H.bead.color,g={rgb:h.rgb,r:h.r,g:h.g,b:h.b,a:0},a.active){for(f=0;f<e&&(d=c[f],!(d.height>b));)f+=1;c.splice(f,0,{height:b,color:g})}return g}function Qb(a){return a.glyph.code>0?a.border.gmax:a.border.max}function Rb(a,b){a.border.equal=!0,a.border.width=b,a.border.top=b,a.border.left=b,a.border.bottom=b,a.border.right=b}function Sb(a){var b,c,d,e,f,g,h;b=U.bead_size,a.scale<100?(c=Math.floor(b*a.scale/100),(d=b-c)>0&&d%2&&(c+=1)):(c=b,a.margin=0,a.senseLeft=a.left,a.senseRight=a.right,a.senseTop=a.top,a.senseBottom=a.bottom),a.size=c,c!==b&&(a.margin=e=Math.floor((b-c)/2),a.senseLeft=a.left+e,a.senseRight=a.right-e,a.senseTop=a.top+e,a.senseBottom=a.bottom-e),h=a.border,h.max=Math.floor((c-a.minimum)/2),h.gmax=Math.floor((c-a.glyph.size)/2),f=Qb(a),h.equal?h.width>f&&Rb(a,f):(g=h.top,g>f&&(h.top=f),g=h.left,g>f&&(h.left=f),g=h.bottom,g>f&&(h.bottom=f),(g=h.right)>f&&(h.right=f))}function Tb(a){var b;return b=a.data,null===b&&(b=0),b}function Ub(a){$={start:a,end:0,duration:0,events:[]}}function Vb(a,b,c){$.events.push({x:a,y:b,start:c,end:0,duration:0})}function Wb(a){var b,c;(b=$.events.length)>0&&(c=$.events[b-1],$.end=a,c.end=a,c.duration=a-c.start,$.duration+=c.duration)}function Xb(){var a,b,c,d;for(a={start:$.start,end:$.end,duration:$.duration,events:[]},b=$.events.length,c=0;c<b;c+=1)d=$.events[c],a.events.push({x:d.x,y:d.y,start:d.start,end:d.end,duration:d.duration});return a}function Yb(a){var b,c;if(b=!1,$.events.length>1){Wb(a),c=Xb();try{PS.swipe(c,{time:a}),b=!0}catch(a){return tb("PS.swipe() failed ["+a.message+"]",a)}}return $=null,b}function $b(a){var b,c,d;if(a.active){if(c=!1,Zb.time=a.timeTouch=d=fa,PS.swipe&&(Ub(d),Vb(a.x,a.y,d)),a.exec)try{b=Tb(a),a.exec(a.x,a.y,b,Zb),c=!0}catch(b){return tb("Bead "+a.x+", "+a.y+" function failed ["+b.message+"]",b)}if(PS.touch)try{b=Tb(a),PS.touch(a.x,a.y,b,Zb),c=!0}catch(a){return tb("PS.touch() failed ["+a.message+"]",a)}c&&kb()}return PS.DONE}function ac(a){var b,c;if(a.active){if(a.timeRelease=c=fa,PS.release){try{b=Tb(a),_b.time=c,PS.release(a.x,a.y,b,_b)}catch(a){return tb("PS.release() failed ["+a.message+"]",a)}kb()}PS.swipe&&Yb()}return PS.DONE}function cc(a){var b,c;if(Fa=!0,a.active&&(a.timeEnter=b=fa,Da&&PS.swipe&&$&&Vb(a.x,a.y,b),PS.enter)){try{c=Tb(a),bc.time=b,bc.touching=Da,PS.enter(a.x,a.y,c,bc)}catch(a){return tb("PS.enter() failed ["+a.message+"]",a)}kb()}return PS.DONE}function ec(a){var b,c;if(a.active&&(a.timeExit=b=fa,Da&&PS.swipe&&$&&Wb(b),PS.exit)){try{c=Tb(a),dc.time=b,dc.touching=Da,PS.exit(a.x,a.y,c,dc)}catch(a){return tb("PS.exit() failed ["+a.message+"]",a)}kb()}return PS.DONE}function gc(){var a;if(Fa=!1,U.timeExit=a=fa,PS.exitGrid){try{fc.time=a,fc.touching=Da,PS.exitGrid(fc)}catch(a){return tb("PS.exitGrid() failed ["+a.message+"]",a)}kb()}return Da&&PS.swipe&&$&&Vb(-1,-1,a),PS.DONE}function hc(){Fa=!1,Ga=A,Ha=A,Da=!1,$=null,Ea=A}function ic(a,b){var c,d,e,f;if(c=U.canvas,a+=document.body.scrollLeft+document.documentElement.scrollLeft-c.offsetLeft-U.padLeft,b+=document.body.scrollTop+document.documentElement.scrollTop-c.offsetTop-U.padRight,a>=U.left&&a<U.right&&b>=U.top&&b<U.bottom)for(e=0;e<U.count;){if(d=V[e],b>=d.top&&b<d.bottom){for(f=0;f<U.x;f+=1){if(a>=d.senseLeft&&a<d.senseRight&&b>=d.senseTop&&b<d.senseBottom)return d;e+=1,d=V[e]}return null}e+=U.x}return null}function jc(a){var b;return Ka&&Ja.blur(),b=fa,Da=!0,PS.swipe&&(Ub(b),Vb(-1,-1,b)),Ta(a)}function kc(a){return PS.swipe&&$&&Yb(fa),Da=!1,Ta(a)}function lc(a){return Ja.focus(),Ta(a)}function mc(a){return Ta(a)}function nc(a){var b,c,d;return Ka&&Ja.blur(),b=a.clientX,c=a.clientY,Da=!0,d=ic(b,c),d&&$b(d),Ta(a)}function oc(a){var b,c,d;return b=a.clientX,c=a.clientY,d=ic(b,c),d&&ac(d),Da=!1,Ta(a)}function pc(a){var b,c,d,e;return b=a.clientX,c=a.clientY,d=ic(b,c),d?d.index!==Ga&&(Ga!==A&&(e=V[Ga],ec(e)),cc(d),Ga=d.index):Ga!==A&&(e=V[Ga],ec(e),Ga=A),Ta(a)}function qc(c){var d,e;return Ga!==A&&(d=V[Ga],ec(d),Ga=A),e=c.relatedTarget,e&&(e=e.id)&&(e===a||e===b||e.length<1)&&gc(),Ta(c)}function rc(a){var b,c,d,e;return Ka&&Ja.blur(),Ea!==A?Ta(a):(d=a.changedTouches[0],Ea=d.identifier,Da=!0,b=d.pageX,c=d.pageY,e=ic(b,c),e?(Fa=!0,$b(e),Ha=e.index):(Ha=A,Fa=!1),Ta(a))}function sc(a){var b,c,d,f,g,h;for(b=a.changedTouches.length,c=0;c<b;c+=1)if(d=a.changedTouches[c],d.identifier===Ea){Ea=A,Fa=!1,f=d.pageX,g=d.pageY,h=ic(f,g),h&&ac(h),Ha=A,Da=!1;break}return Ta(a)}function tc(a){var b,c,d,f,g,h,i;for(b=a.changedTouches.length,c=0;c<b;c+=1)if(d=a.changedTouches[c],d.identifier===Ea){f=d.pageX,g=d.pageY,h=ic(f,g),h?(Fa=!0,Ha!==h.index&&(Ha!==A&&(i=V[Ha],ec(i)),cc(h),Ha=h.index)):(Ha!==A&&(i=V[Ha],ec(i)),Ha=A,Fa&&gc());break}return Ta(a)}function uc(){var a;for(ua.length=0,va=!1,wa=!1,xa=!1,a=0;a<256;a+=1)ta[a]=0}function vc(a,b){var c;return c=a,c>=65&&c<=90?b||(c+=32):(c=qa[c],b&&c<256&&(c=ra[c])),c}function wc(a){return a>=32||13===a||8===a||9===a||27===a}function xc(a){var b,c,d,e,f,g;if(b="[_keyDown] ",c=!1,La)return!0;if(va=a.shiftKey,wa=a.ctrlKey,xa=a.altKey,d=a.which?a.which:a.keyCode,e=vc(d,va),wc(e)){if(!ta[e]&&(ta[e]=1,e!==d&&ta[d]&&(ta[d]=0,(g=ua.indexOf(d))>=0&&ua.splice(g,1)),ua.length<1&&(za=Ba),ua.indexOf(e)<0&&ua.push(e),PS.keyDown))try{Db.time=fa,PS.keyDown(e,va,wa,Db),c=!0}catch(a){tb(b+"PS.keyDown failed ["+a.message+"]",a)}}else if(e===z)for(f=ua.length,g=0;g<f;g+=1)if(e=d=ua[g],d>=97&&d<=122?e-=32:d<256&&(e=ra[d]),e!==d&&(ta[d]=0,ta[e]=1,ua[g]=e,PS.keyDown))try{Db.time=fa,PS.keyDown(e,!0,wa,Db),c=!0}catch(a){tb(b+"PS.keyDown failed ["+a.message+"]",a)}return c&&kb(),Ta(a)}function zc(a){var b,c,d,e,f,g,h,i;if(b="[_keyUp] ",c=!1,La)return!0;if(d=va=a.shiftKey,e=wa=a.ctrlKey,f=a.which?a.which:a.keyCode,g=vc(f,va),wc(g)){if(ta[g]=0,h=ua.indexOf(g),h>=0&&ua.splice(h,1),ua.length<1&&(za=0,va=!1,wa=!1,xa=!1),PS.keyUp)try{yc.time=fa,PS.keyUp(g,d,e,yc),c=!0}catch(a){tb(b+"PS.keyUp failed ["+a.message+"]",a)}}else if(g===z)for(i=ua.length,h=0;h<i;h+=1)if(g=f=ua[h],f<256&&(g=sa[f]),g!==f&&(ta[f]=0,ta[g]=1,ua[h]=g,PS.keyDown))try{yc.time=fa,PS.keyDown(g,!1,e,yc),c=!0}catch(a){tb(b+"PS.keyDown failed ["+a.message+"]",a)}return c&&kb(),Ta(a)}function Cc(a){var b;if(!Fa)return!0;if(a||(a=window.event),b=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail)),b=b>=1?PS.WHEEL_FORWARD:PS.WHEEL_BACKWARD,PS.input){try{Ac.wheel=b,Bc.time=fa,PS.input(Ac,Bc)}catch(a){tb("PS.input() failed ["+a.message+"]",a)}kb()}return Ta(a)}function Dc(){pa||(uc(),document.addEventListener("keydown",xc,!1),document.addEventListener("keyup",zc,!1),pa=!0)}function Ec(){pa&&(pa=!1,document.removeEventListener("keydown",xc,!1),document.removeEventListener("keyup",zc,!1))}function Hc(a){var b;if(b="Are you sure you want to exit Perlenspiel?",PS.shutdown&&Pa>0){Gc=!0;try{Fc.time=fa,PS.shutdown(Fc)}catch(a){tb("PS.shutdown() failed ["+a.message+"]",a)}}return a.returnValue=b,b}function Ic(){var a;a=U.canvas,a.style.display="block",hc(),document.addEventListener("mousedown",jc,!1),document.addEventListener("mouseup",kc,!1),a.addEventListener("mousedown",nc,!1),a.addEventListener("mouseup",oc,!1),a.addEventListener("mousemove",pc,!1),a.addEventListener("mouseout",qc,!1),Dc(),window.addEventListener("DOMMouseScroll",Cc,!1),window.addEventListener("mousewheel",Cc,!1),Ca&&(document.addEventListener("touchmove",tc,!1),document.addEventListener("touchstart",rc,!1),document.addEventListener("touchend",sc,!1),document.addEventListener("touchcancel",sc,!1))}function Jc(a){var b,c,d,e,f,g;return b=U.color,c=U.fader,(d=a.rgb)===PS.CURRENT?b.rgb:(null===d?(e=a.r,e===PS.CURRENT?a.r=e=b.r:e===PS.DEFAULT&&(a.r=e=H.grid.color.r),f=a.g,f===PS.CURRENT?a.g=f=b.g:f===PS.DEFAULT&&(a.g=f=H.grid.color.g),g=a.b,g===PS.CURRENT?a.b=g=b.b:g===PS.DEFAULT&&(a.b=g=H.grid.color.b),a.rgb=e*u+f*v+g):d===PS.DEFAULT&&(a={r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"}),(b.rgb!==a.rgb||c.rate>0&&null!==c.rgb&&c.rgb!==a.rgb)&&(b.rgb=a.rgb,e=a.r,f=a.g,g=a.b,b.str=a.str=J[e]+L[f]+M[g],c.rate>0?null!==c.rgb?Ab(c,c.r,c.g,c.b,255,e,f,g,255):c.active?Bb(c,e,f,g,255):Ab(c,b.r,b.g,b.b,255,e,f,g,255):(cb(a),db(a)),b.r=e,b.g=f,b.b=g),b.rgb)}function Kc(a,b){var c,d,e,f,g;return c=U.shadow,d=b.rgb,d!==PS.CURRENT&&(null===d?(e=b.r,e===PS.CURRENT?b.r=e=c.r:e===PS.DEFAULT&&(b.r=e=H.grid.shadow.r),f=b.g,f===PS.CURRENT?b.g=f=c.g:f===PS.DEFAULT&&(b.g=f=H.grid.shadow.g),g=b.b,g===PS.CURRENT?b.b=g=c.b:g===PS.DEFAULT&&(b.b=g=H.grid.shadow.b),b.rgb=e*u+f*v+g):d===PS.DEFAULT&&(b={show:!1,r:192,g:192,b:192,a:255,rgb:12632256,str:"rgba(192,192,192,1)",params:"0px 0px 64px 8px "}),c.rgb!==b.rgb&&(c.rgb=b.rgb,e=b.r,f=b.g,g=b.b,c.str=b.str=J[e]+L[f]+M[g],c.r=e,c.g=f,c.b=g)),a!==PS.CURRENT&&(U.shadow.show=a),U.shadow.show?eb(c):U.canvas.style.boxShadow="none",{show:U.shadow.show,rgb:c.rgb}}function Lc(a,b){var c,d,e,f,g,h,i;if(wb(),xb(U.fader),xb(W.fader),hc(),U.plane=0,U.ready&&a===U.x&&b===U.y)for(d=0;d<U.count;d+=1)i=V[d],Ob(i),Sb(i);else{for(U.x=a,U.y=b,U.count=a*b,U.left=0,U.top=0,c=a>=b?Math.floor(S/a):Math.floor(S/b),U.bead_size=c,U.width=c*a,U.height=c*b,U.right=U.width,U.bottom=U.height,U.canvas.width=U.width,U.canvas.height=U.height,U.context.textAlign="center",U.context.textBaseline="middle",f=0,h=U.top,e=0;e<b;e+=1){for(g=U.left,d=0;d<a;d+=1)i=V[f],i.x=d,i.y=e,i.left=g,i.right=g+c,i.top=h,i.bottom=h+c,Ob(i),Sb(i),g+=c,f+=1;h+=c}for(;f<w;)i=V[f],i.visible=!1,i.active=!1,f+=1}X=!0,Jc({rgb:PS.DEFAULT}),PS.statusColor(PS.DEFAULT),kb(),U.ready=!0}function Mc(a,b){return"number"!==Qa(a)?ub(b+"x argument not a number"):(a=Math.floor(a),a<0?ub(b+"x argument negative"):a>=U.x?ub(b+"x argument exceeds grid width"):a)}function Nc(a,b){return"number"!==Qa(a)?ub(b+"y argument not a number"):(a=Math.floor(a),a<0?ub(b+"y argument negative"):a>=U.y?ub(b+"y argument exceeds grid height"):a)}function Oc(a,b,c,d,e,f,g,h){var i,j,k;if(c===PS.ALL){if(d===PS.ALL){for(j=0;j<U.y;j+=1)for(i=0;i<U.x&&(k=b(i,j,e,f,g,h))!==PS.ERROR;i+=1);return k}if((d=Nc(d,a))===PS.ERROR)return PS.ERROR;for(i=0;i<U.x&&(k=b(i,d,e,f,g,h))!==PS.ERROR;i+=1);return k}if(d===PS.ALL){if((c=Mc(c,a))===PS.ERROR)return PS.ERROR;for(j=0;j<U.y&&(k=b(c,j,e,f,g,h))!==PS.ERROR;j+=1);return k}return(c=Mc(c,a))===PS.ERROR?PS.ERROR:(d=Nc(d,a))===PS.ERROR?PS.ERROR:k=b(c,d,e,f,g,h)}function Pc(a,b,c){var d,e,f,g,h,i,j,k,l;return d=b*U.x+a,e=V[d],f=H.bead.color,g=Pb(e,U.plane),h=e.fader,i=c.rgb,e.active&&i!==PS.CURRENT?(null===i?(j=c.r,j===PS.CURRENT?c.r=j=g.r:j===PS.DEFAULT&&(c.r=j=f.r),k=c.g,k===PS.CURRENT?c.g=k=g.g:k===PS.DEFAULT&&(c.g=k=f.g),l=c.b,l===PS.CURRENT?c.b=l=g.b:l===PS.DEFAULT&&(c.b=l=f.b),c.rgb=j*u+k*v+l):i===PS.DEFAULT&&(c={r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"}),(g.rgb!==c.rgb||h.rate>0&&null!==h.rgb&&h.rgb!==c.rgb)&&(g.rgb=c.rgb,g.r=c.r,g.g=c.g,g.b=c.b,Ib(e)),g.rgb):g.rgb}function Qc(a,b,c){var d,e,f;return d=b*U.x+a,e=V[d],f=Pb(e,U.plane),e.active&&c!==PS.CURRENT&&c!==f.a&&(f.a=c,Ib(e)),f.a}function Rc(a,b){var c,d,e,f,g,h,i;if("undefined"===(c=Qa(b))||b===PS.CURRENT)return{rgb:PS.CURRENT,r:0,g:0,b:0,onStep:PS.CURRENT,onEnd:PS.CURRENT,params:PS.CURRENT};if(b===PS.DEFAULT)return{rgb:PS.DEFAULT,r:0,g:0,b:0,onStep:PS.DEFAULT,onEnd:PS.DEFAULT,params:PS.DEFAULT};if("object"!==c)return ub(a+"options argument invalid");if((d=b.rgb)!==PS.CURRENT&&d!==PS.DEFAULT)if("undefined"===(c=Qa(d))||null===d)b.rgb=PS.CURRENT;else{if("number"!==c)return ub(a+"options.rgb property invalid");d=Math.floor(d),d<=PS.COLOR_BLACK?(d=PS.COLOR_BLACK,e=0,g=0,f=0):d>=PS.COLOR_WHITE?(d=PS.COLOR_WHITE,e=255,g=255,f=255):(e=d/u,e=Math.floor(e),h=e*u,g=(d-h)/v,g=Math.floor(g),i=g*v,f=d-h-i),b.rgb=d,b.r=e,b.g=g,b.b=f}else b.r=0,b.g=0,b.b=0;if((d=b.onStep)!==PS.CURRENT&&d!==PS.DEFAULT)if("undefined"===(c=Qa(d))||null===d)b.onStep=PS.CURRENT;else if("function"!==c)return ub(a+"options.onStep property invalid");if((d=b.onEnd)!==PS.CURRENT&&d!==PS.DEFAULT)if("undefined"===(c=Qa(d))||null===d)b.onEnd=PS.CURRENT;else if("function"!==c)return ub(a+"options.onEnd property invalid");if((d=b.params)!==PS.CURRENT&&d!==PS.DEFAULT)if("undefined"===(c=Qa(d))||null===d)b.params=PS.CURRENT;else if("array"!==c)return ub(a+"options.params property invalid");return b}function Sc(a,b,c,d){var e,f,g,h,i,j,k;return e=b*U.x+a,f=V[e],g=f.color,h=f.fader,i=h.rate,f.active&&(j=c===PS.CURRENT?i:c===PS.DEFAULT?H.fader.rate:c,k=d.rgb,k!==PS.CURRENT&&(k===PS.DEFAULT?h.rgb=H.fader.rgb:h.rgb=k,h.r=d.r,h.g=d.g,h.b=d.b),k=d.onStep,k!==PS.CURRENT&&(k===PS.DEFAULT?h.onStep=H.fader.onStep:h.onStep=k),k=d.onEnd,k!==PS.CURRENT&&(k===PS.DEFAULT?h.onEnd=H.fader.onEnd:h.onEnd=k),k=d.params,k!==PS.CURRENT&&(k===PS.DEFAULT?h.params=H.fader.params:h.params=k),i!==j&&(h.rate=j,j<1?(h.active=!1,h.kill=!0):h.active&&Bb(h,g.r,g.g,g.b,255))),{rate:h.rate,rgb:h.rgb,onStep:h.onStep,onEnd:h.onEnd,params:h.params}}function Tc(a,b,c){var d,e;return d=b*U.x+a,e=V[d],e.active&&c!==PS.CURRENT&&e.scale!==c&&(e.scale=c,Sb(e),jb(e)),e.scale}function Uc(a,b,c){var d,e,f;return d=b*U.x+a,e=V[d],e.active&&c!==PS.CURRENT&&e.radius!==c&&(e.radius=c,!e.border.equal&&c>0&&(f=Math.max(e.border.top,e.border.left,e.border.bottom,e.border.right),Rb(e,f)),jb(e)),e.radius}function Vc(a,b,c){var d,e,f,g,h,i,j,k;return d=b*U.x+a,e=V[d],f=H.bead.bgColor,g=e.bgColor,h=c.rgb,e.active&&h!==PS.CURRENT?(null===h?(i=c.r,i===PS.CURRENT?c.r=i=g.r:i===PS.DEFAULT&&(c.r=i=f.r),j=c.g,j===PS.CURRENT?c.g=j=g.g:j===PS.DEFAULT&&(c.g=j=f.g),k=c.b,k===PS.CURRENT?c.b=k=g.b:k===PS.DEFAULT&&(c.b=k=f.b),c.rgb=i*u+j*v+k):h===PS.DEFAULT&&(c={r:255,g:255,b:255,a:0,rgb:16777215,str:"rgba(255,255,255,0)"}),g.rgb!==c.rgb&&(g.rgb=c.rgb,g.r=i=c.r,g.g=j=c.g,g.b=k=c.b,g.str=J[i]+L[j]+L[k]+N[g.a],e.active&&(e.scale<100||e.radius>0)&&jb(e)),g.rgb):g.rgb}function Wc(a,b,c){var d,e,f;return d=b*U.x+a,e=V[d],f=e.bgColor,c!==PS.CURRENT&&c!==f.a&&(f.a=c,f.str=J[f.r]+L[f.g]+L[f.b]+N[c],e.active&&(e.scale<100||e.radius>0)&&jb(e)),f.a}function Xc(a,b,c){var d,e;return d=b*U.x+a,e=V[d],e.active&&c!==PS.CURRENT&&(null===c?(e.data=H.bead.data,e.fader.data=e.data,e.borderFader.data=e.data,e.glyphFader.data=e.data):(e.data=c,e.fader.data=c,e.borderFader.data=c,e.glyphFader.data=c)),e.data}function Yc(a,b,c){var d,e;return d=b*U.x+a,e=V[d],e.active&&c!==PS.CURRENT&&(e.exec=c),e.exec}function Zc(a,b,c){var d,e;return d=b*U.x+a,e=V[d],e.active&&c!==PS.CURRENT&&e.visible!==c&&(e.visible=c,c||(e.fader.kill=!0,e.borderFader.kill=!0,e.glyphFader.kill=!0),jb(e)),e.visible}function $c(a,b,c){var d,e;return d=b*U.x+a,e=V[d],c!==PS.CURRENT&&(e.active=c),e.active}function _c(a,b,c){var d,e;return d=b*U.x+a,e=V[d],e.active&&c!==PS.CURRENT&&e.minimum!==c&&(c>e.size&&(c=e.size),e.minimum=c,Sb(e),jb(e)),e.minimum}function ad(a,b,c){var d,e,f,g,h,i,j,k,l;return d=b*U.x+a,e=V[d],e.active&&c!==PS.CURRENT&&(f=Qb(e),"number"===Qa(c)?(c>f&&(c=f),c!==e.border.width&&(Rb(e,c),jb(e))):(h=!1,i=c.top,i===PS.CURRENT?i=e.border.top:(i>f&&(i=f),i!==e.border.top&&(e.border.top=i,h=!0)),j=c.left,j===PS.CURRENT?j=e.border.left:(j>f&&(j=f),j!==e.border.left&&(e.border.left=j,h=!0)),k=c.bottom,k===PS.CURRENT?k=e.border.bottom:(k>f&&(k=f),k!==e.border.bottom&&(e.border.bottom=k,h=!0)),l=c.right,l===PS.CURRENT?l=e.border.right:(l>f&&(l=f),l!==e.border.right&&(e.border.right=l,h=!0)),i===j&&i===l&&i===k?(Rb(e,i),h&&jb(e)):e.radius>0?(f=Math.max(i,j,k,l),Rb(e,f),jb(e)):(e.border.equal=!1,h&&jb(e)))),g={top:e.border.top,left:e.border.left,bottom:e.border.bottom,right:e.border.right,equal:e.border.equal},e.border.equal||(e.border.width=Math.max(g.top,g.left,g.bottom,g.right)),g.width=e.border.width,g}function bd(a,b,c){var d,e,f,g,h,i,j,k,l,m;return d=b*U.x+a,e=V[d],f=e.border.color,g=H.bead.border.color,h=e.borderFader,i=c.rgb,e.active&&i!==PS.CURRENT&&(null===i?(j=c.r,j===PS.CURRENT?c.r=j=f.r:j===PS.DEFAULT&&(c.r=j=g.r),k=c.g,k===PS.CURRENT?c.g=k=f.g:k===PS.DEFAULT&&(c.g=k=g.g),l=c.b,l===PS.CURRENT?c.b=l=f.b:l===PS.DEFAULT&&(c.b=l=g.b),c.rgb=j*u+k*v+l):i===PS.DEFAULT&&(c={r:128,g:128,b:128,a:255,rgb:8421504,str:"rgba(128,128,128,1)"}),(f.rgb!==c.rgb||h.rate>0&&null!==h.rgb&&h.rgb!==c.rgb)&&(f.rgb=c.rgb,j=c.r,k=c.g,l=c.b,c.a=m=f.a,f.str=c.str=J[j]+L[k]+L[l]+N[m],e.visible&&(h.rate>0?null!==h.rgb?Ab(h,h.r,h.g,h.b,m,j,k,l,m):h.active?Bb(h,j,k,l,m):Ab(h,f.r,f.g,f.b,m,j,k,l,m):jb(e)),f.r=j,f.g=k,f.b=l)),f.rgb}function cd(a,b,c){var d,e,f,g,h,i,j;return d=b*U.x+a,e=V[d],f=e.border.color,e.active&&c!==PS.CURRENT&&c!==f.a&&(g=f.r,h=f.g,i=f.b,f.str=J[g]+L[h]+L[i]+N[c],e.visible&&(j=e.borderFader,j.rate>0?j.active?Bb(j,g,h,i,c):null!==j.rgb?Ab(j,j.r,j.g,j.b,f.a,g,h,i,c):Ab(j,g,h,i,f.a,g,h,i,c):jb(e)),f.a=c),f.a}function dd(a,b,c,d){var e,f,g,h,i,j,k;return e=b*U.x+a,f=V[e],h=f.border.color,g=f.borderFader,i=g.rate,f.active&&(j=c===PS.CURRENT?i:c===PS.DEFAULT?H.fader.rate:c,k=d.rgb,k!==PS.CURRENT&&(k===PS.DEFAULT?g.rgb=H.fader.rgb:g.rgb=k,g.r=d.r,g.g=d.g,g.b=d.b),k=d.onStep,k!==PS.CURRENT&&(k===PS.DEFAULT?g.onStep=H.fader.onStep:g.onStep=k),k=d.onEnd,k!==PS.CURRENT&&(k===PS.DEFAULT?g.onEnd=H.fader.onEnd:g.onEnd=k),k=d.params,k!==PS.CURRENT&&(k===PS.DEFAULT?g.params=H.fader.params:g.params=k),i!==j&&(g.rate=j,j<1?(g.active=!1,g.kill=!0):g.active&&Bb(g,h.r,h.g,h.b,255))),{rate:g.rate,rgb:g.rgb,onStep:g.onStep,onEnd:g.onEnd,params:g.params}}function ed(a,b,c){var d,e,f;return d=b*U.x+a,e=V[d],e.active&&c!==PS.CURRENT&&e.glyph.code!==c&&(e.glyph.code=c,f=c<1?"":String.fromCodePoint(c),e.glyph.str=f,jb(e)),e.glyph.code}function fd(a,b,c){var d,e,f,g,h,i,j,k,l,m;return d=b*U.x+a,e=V[d],f=e.glyph.color,g=H.bead.glyph.color,h=e.glyphFader,i=c.rgb,e.active&&i!==PS.CURRENT&&(null===i?(j=c.r,j===PS.CURRENT?c.r=j=f.r:j===PS.DEFAULT&&(c.r=j=g.r),k=c.g,k===PS.CURRENT?c.g=k=f.g:k===PS.DEFAULT&&(c.g=k=g.g),l=c.b,l===PS.CURRENT?c.b=l=f.b:l===PS.DEFAULT&&(c.b=l=g.b),c.rgb=j*u+k*v+l):i===PS.DEFAULT&&(c={r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}),(f.rgb!==c.rgb||h.rate>0&&null!==h.rgb&&h.rgb!==c.rgb)&&(f.rgb=c.rgb,j=c.r,k=c.g,l=c.b,c.a=m=f.a,f.str=c.str=J[j]+L[k]+L[l]+N[m],e.visible&&(h.rate>0?(null!==h.rgb&&Ab(h,h.r,h.g,h.b,m,j,k,l,m),h.active?Bb(h,j,k,l,m):Ab(h,f.r,f.g,f.b,m,j,k,l,m)):jb(e)),f.r=j,f.g=k,f.b=l)),f.rgb}function gd(a,b,c){var d,e,f,g,h,i,j;return d=b*U.x+a,e=V[d],f=e.glyph.color,e.active&&c!==PS.CURRENT&&c!==f.a&&(g=f.r,h=f.g,i=f.b,f.str=J[g]+L[h]+L[i]+N[c],e.visible&&(j=e.glyphFader,j.rate>0?j.active?Bb(j,g,h,i,c):Ab(j,g,h,i,f.a,g,h,i,c):jb(e)),f.a=c),f.a}function hd(a,b,c){var d,e,f;return d=b*U.x+a,e=V[d],f=e.glyph.scale,e.active&&c!==PS.CURRENT&&c!==f&&(e.glyph.scale=c,e.visible&&(Nb(e),jb(e))),e.glyph.scale}function id(a,b,c,d){var e,f,g,h,i,j,k;return e=b*U.x+a,f=V[e],g=f.glyph.color,h=f.glyphFader,i=h.rate,f.active&&(j=c===PS.CURRENT?i:c===PS.DEFAULT?H.fader.rate:c,k=d.rgb,k!==PS.CURRENT&&(k===PS.DEFAULT?h.rgb=H.fader.rgb:h.rgb=k,h.r=d.r,h.g=d.g,h.b=d.b),k=d.onStep,k!==PS.CURRENT&&(k===PS.DEFAULT?h.onStep=H.fader.onStep:h.onStep=k),k=d.onEnd,k!==PS.CURRENT&&(k===PS.DEFAULT?h.onEnd=H.fader.onEnd:h.onEnd=k),k=d.params,k!==PS.CURRENT&&(k===PS.DEFAULT?h.params=H.fader.params:h.params=k),i!==j&&(h.rate=j,j<1?(h.active=!1,h.kill=!0):h.active&&Bb(h,g.r,g.g,g.b,255))),{rate:h.rate,rgb:h.rgb,onStep:h.onStep,onEnd:h.onEnd,params:h.params}}function jd(a){var b,c,d,e,f;for(b=a.getAttribute("data-id"),c=aa.length,d=0;d<c;d+=1)if(e=aa[d],e.id===b){f=e.exec,aa.splice(d,1);break}try{f(PS.ERROR)}catch(a){tb("[PS.imageLoad] .exec function failed ["+a.message+"]",a)}ub("[PS.imageLoad] Error loading "+a.src)}function kd(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(c="[_imageExtract] ",d=a.width,"number"!==Qa(d)||d<1)return ub(c+"image width invalid");if(d=Math.floor(d),e=a.height,"number"!==Qa(e)||e<1)return ub(c+"image height invalid");e=Math.floor(e);try{_.width=d,_.height=e,f=_.getContext("2d"),f.drawImage(a,0,0,d,e,0,0,d,e)}catch(a){return tb(c+"image extraction failed @ 1 ["+a.message+"]",a)}try{g=f.getImageData(0,0,d,e)}catch(a){return tb(c+"image extraction failed @ 2 ["+a.message+"]",a)}if(h={width:g.width,height:g.height},i=g.data,j=i.length,k=[],m=l=0,1===b)for(k.length=j/4;l<j;)n=i[l],o=i[l+1],p=i[l+2],k[m]=n*u+o*v+p,l+=4,m+=1;else if(2===b)for(k.length=j/2;l<j;)n=i[l],o=i[l+1],p=i[l+2],q=i[l+3],k[m]=n*u+o*v+p,k[m+1]=q,l+=4,m+=2;else if(3===b)for(k.length=j/4*3;l<j;)n=i[l],o=i[l+1],p=i[l+2],k[m]=n,k[m+1]=o,k[m+2]=p,l+=4,m+=3;else for(k.length=j;l<j;)k[l]=i[l],l+=1,k[l]=i[l],l+=1,k[l]=i[l],l+=1,k[l]=i[l],l+=1;return h.pixelSize=b,h.data=k,h}function ld(a){var b,c,d,e,f,g,h,i;for(b=a.getAttribute("data-id"),c=aa.length,d=0;d<c;d+=1)if(e=aa[d],e.id===b){f=e.exec,g=e.format,h=e.source,aa.splice(d,1);break}if((i=kd(a,g))!==PS.ERROR)try{i.source=h,i.id=b,f(i)}catch(a){tb("[PS.imageLoad] .exec function failed ["+a.message+"]",a)}}function md(a,b){var c,d,e,f,g,h,i,j;if("object"!==Qa(b))return ub(a+"image argument not an object");if(c=b.width,"number"!==Qa(c))return ub(a+"image.width not a number");if((c=Math.floor(c))<1)return ub(a+"image.width < 1");if(b.width=c,d=b.height,"number"!==Qa(d))return ub(a+"image.height not a number");if((d=Math.floor(d))<1)return ub(a+"image.height < 1");if(b.height=d,e=b.pixelSize,"number"!==Qa(e))return ub(a+"image.pixelSize not a number");if((e=Math.floor(e))<1&&e>4)return ub(a+"image.pixelSize is not 1, 2, 3 or 4");if(b.pixelSize=e,g=b.data,"array"!==Qa(g))return ub(a+"image.data is not an array");if(h=g.length,f=c*d*e,h!==f)return ub(a+"image.data length invalid");for(i=0;i<h;i+=1){if(j=g[i],"number"!==Qa(j))return ub(a+"image.data["+i+"] not a number");if(j<0)return ub(a+"image.data["+i+"] negative");if(e<3){if(j>16777215)return ub(a+"image.data["+i+"] > 0xFFFFFF")}else if(j>255)return ub(a+"image.data["+i+"] > 255")}return!0}function nd(a,b){var c,d;if(c=a.toString(16).toUpperCase(),b)for(d=c.length;d<b;)c="0"+c,d+=1;return"0x"+c}function od(a,b,c,d,e,f,g){var h;return a<3?(h="",h+=b?nd(c,6):c,2===a&&(h+=b?", "+nd(g,2):", "+g)):(h=b?nd(d,2)+", "+nd(e,2)+", "+nd(f,2):d+", "+e+", "+f,4===a&&(h+=b?", "+nd(g,2):", "+g)),h}function pd(){var a;return a={id:m+da,placed:!1,visible:!0,x:0,y:0,ax:0,ay:0,image:null,color:null,collide:null,width:0,height:0,plane:-1},da+=1,ca.push(a),a}function qd(a,b){var c,d,e;if("string"!=typeof a||a.length<1)return ub(b+"sprite argument invalid");for(c=ca.length,d=0;d<c;d+=1)if(e=ca[d],e.id===a)return e;return ub(b+"sprite id '"+a+"' does not exist")}function rd(a,b,c,d,e){var f,g,h,i,j,k,l,m,n;if(void 0===b&&(b=a.x,c=a.y,d=a.width,e=a.height),f=U.x,!((b-=a.ax)>=f)){if(b<0){if((d+=b)<1)return;b=0}if(b+d>f&&(d=f-b),h=b+d,g=U.y,!((c-=a.ay)>=g)){if(c<0){if((e+=c)<1)return;c=0}for(c+e>g&&(e=g-c),i=c+e,k=c;k<i;k+=1)for(j=b;j<h;j+=1)m=j+k*f,l=V[m],l.active&&(n=Pb(l,a.plane),n.r=255,n.g=255,n.b=255,n.a=0,n.rgb=16777215,Ib(l))}}}function sd(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,w,x,y;if(b=a.width,c=a.height,!(b<1||c<1||(d=U.x,j=0,(f=a.x-a.ax)>=d))){if(f<0){if((b+=f)<1)return;f=0,j=a.width-b}if(f+b>d&&(b=d-f),h=f+b,e=U.y,k=0,!((g=a.y-a.ay)>=e)){if(g<0){if((c+=g)<1)return;g=0,k=a.height-c}if(g+c>e&&(c=e-g),i=g+c,l=a.color)for(n=g;n<i;n+=1)for(m=f;m<h;m+=1)p=m+n*d,o=V[p],o.active&&(q=Pb(o,a.plane),q.rgb=l.rgb,q.r=l.r,q.g=l.g,q.b=l.b,q.a=l.a,Ib(o));else for(r=a.image.data,n=g;n<i;n+=1){for(s=4*(k*a.width+j),m=f;m<h;m+=1)p=m+n*d,o=V[p],o.active&&(t=r[s],w=r[s+1],x=r[s+2],y=r[s+3],q=Pb(o,a.plane),q.rgb=t*u+w*v+x,q.r=t,q.g=w,q.b=x,q.a=y,Ib(o)),s+=4;k+=1}}}}function td(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;for(c="[_collisionCheck] ",f=a.x-a.ax,g=a.y-a.ay,h=a.width,i=a.height,j=a.collide,d=ca.length,e=0;e<d;e+=1)if(k=ca[e],(l=k.id)!==b&&k.visible&&k.placed&&(m=k.x-k.ax,n=k.y-k.ay,o=k.width,p=k.height,q=k.collide,r=m>f?m-f:f-m,s=n>g?n-g:g-n,t=null,f===m-h||f===m+o?(g<=n&&s<=i||g>=n&&s<=p)&&(t=PS.SPRITE_TOUCH):g===n-i||g===n+p?(f<=m&&r<=h||f>=m&&r<=o)&&(t=PS.SPRITE_TOUCH):f>=m&&f<m+o?(g<=n&&s<i||g>=n&&s<p)&&(t=PS.SPRITE_OVERLAP):m>=f&&m<f+h&&(n<=g&&s<p||n>=g&&s<i)&&(t=PS.SPRITE_OVERLAP),t)){if(j)try{j(b,a.plane,l,k.plane,t)}catch(a){return void tb(c+b+" collide function failed ["+a.message+"]",a)}if(q)try{q(l,k.plane,b,a.plane,t)}catch(a){return void tb(c+l+" collide function failed ["+a.message+"]",a)}}}function ud(a){this.content=[],this.scoreFunction=a}function vd(a,b,c,d){var e,f,g,h,i,j,k;for(e=c>a?c-a:a-c,f=d>b?d-b:b-d,g=a<c?1:-1,h=b<d?1:-1,i=e-f,k=[];a!==c||b!==d;){if(j=2*i,j>-f&&(i-=f,a+=g),a===c&&b===d){k.push([a,b]);break}j<e&&(i+=e,b+=h),k.push([a,b])}return k}function wd(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o;for(g=e>c?e-c:c-e,h=f>d?f-d:d-f,i=c<e?1:-1,j=d<f?1:-1,k=g-h,m=[];c!==e||d!==f;){if(l=2*k,l>-h&&(k-=h,c+=i),c===e&&d===f)return m.push([c,d]),m;if(l<g&&(k+=g,d+=j),o=d*b+c,n=a[o],!n.value)return null;m.push([c,d])}return m}function xd(a,b,c,d){var e,f;return e=c>a?c-a:a-c,f=d>b?d-b:b-d,e>f?f*C+(e-f):e*C+(f-e)}function yd(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;return g=[],h=d.x,i=d.y,j=b-1,k=c-1,n=i*b,l=(i-1)*b,m=(i+1)*b,r=!1,s=!1,t=!1,u=!1,h>0&&(o=h-1,p=n+o,q=a[p],q.value?q.closed||(q.cost=q.value,g.push(q)):u=!0),h<j&&(o=h+1,p=n+o,q=a[p],q.value?q.closed||(q.cost=q.value,g.push(q)):t=!0),i>0&&(p=l+h,q=a[p],q.value?q.closed||(q.cost=q.value,g.push(q)):r=!0),i<k&&(p=m+h,q=a[p],q.value?q.closed||(q.cost=q.value,g.push(q)):s=!0),e||(h>0&&(o=h-1,i>0&&(f||!u&&!r)&&(p=l+o,q=a[p],q.value&&!q.closed&&(q.cost=q.value*C,g.push(q))),i<k&&(f||!u&&!s)&&(p=m+o,q=a[p],q.value&&!q.closed&&(q.cost=q.value*C,g.push(q)))),h<j&&(o=h+1,i>0&&(f||!r&&!t)&&(p=l+o,q=a[p],q.value&&!q.closed&&(q.cost=q.value*C,g.push(q))),i<k&&(f||!s&&!t)&&(p=m+o,q=a[p],q.value&&!q.closed&&(q.cost=q.value*C,g.push(q))))),g}function zd(a){return a.f}function Ad(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(b===d&&c===e)return[];if(h=a.width,i=a.height,j=a.nodes,k=c*h+b,l=j[k],!l.value)return[];if(k=e*h+d,l=j[k],!l.value)return[];if(!f&&(m=wd(j,h,b,c,d,e)))return m;for(n=j.length,s=0;s<n;s+=1)l=j[s],l.f=0,l.g=0,l.h=0,l.cost=0,l.closed=!1,l.visited=!1,l.parent=null;for(m=[],o=new ud(zd),k=c*h+b,l=j[k],o.push(l);o.size()>0;){if(p=o.pop(),p.x===d&&p.y===e){for(w=p;w.parent;)m.push([w.x,w.y]),w=w.parent;m.reverse();break}for(p.closed=!0,q=yd(j,h,i,p,f,g),r=q.length,s=0;s<r;s+=1)t=q[s],u=p.g+t.cost,(!(v=t.visited)||u<t.g)&&(t.visited=!0,t.parent=p,t.h=t.h||xd(t.x,t.y,d,e),t.g=u,t.f=t.g+t.h,v?o.rescore(t):o.push(t))}return m}function Bd(a,b,c,d,e,f){var g,h,i,j,k,l,m,n;for(g=[],g.length=d*e,h=a.nodes,i=c+e,m=0,l=c;l<i;l+=1)for(j=l*a.width+b,k=0;k<d;k+=1)n=h[j],f!==PS.CURRENT&&(f===PS.DEFAULT?n.value=n.ovalue:n.value=f),g[m]=n.value,m+=1,j+=1;return g}function Cd(a,b,c){var d,e,f,g,h,i,j,k;for(e=c.length,d=[],d.length=e,f=0,h=0;h<b;h+=1)for(g=0;g<a;g+=1)j=c[f],i={x:g,y:h,value:j,ovalue:j,f:0,g:0,h:0,cost:0,parent:null,closed:!1,visited:!1},d[f]=i,f+=1;return k={id:n+Oa,width:a,height:b,nodes:d},Oa+=1,Na.push(k),k}function Dd(a){var b,c,d;for(b=Na.length,c=0;c<b;c+=1)if(d=Na[c],d.id===a)return d;return null}function Ed(a){var b,c,d,e,f;for(b=Na.length,c=0;c<b;c+=1)if(d=Na[c],d.id===a){for(e=d.nodes,b=e.length,f=0;f<b;f+=1)e[f]=null;return d.nodes=null,Na.splice(c,1),!0}return!1}function Fd(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;for(f=a.nodes,g=a.width,h=a.height,i=1;i<g;){if(j=[],k=d-i,m=d+i,l=e-i,n=e+i,o=k,o<0&&(o=0),p=m+1,p>=g&&(p=g),l>=0)for(q=l*g+o,r=o;r<p;r+=1)s=f[q],s.value&&j.push([s.x,s.y]),q+=1;if(n<h)for(q=n*g+o,r=o;r<p;r+=1)s=f[q],s.value&&j.push([s.x,s.y]),q+=1;if(o=l+1,o<0&&(o=0),p=n,p>=h&&(p=h),k>=0)for(q=o*g+k,r=o;r<p;r+=1)s=f[q],s.value&&j.push([s.x,s.y]),q+=g;if(m<g)for(q=o*g+m,r=o;r<p;r+=1)s=f[q],s.value&&j.push([s.x,s.y]),q+=g;if(t=j.length){if(1===t)return j[0];for(u=g+h,r=0;r<t;r+=1)x=j[r],(w=xd(b,c,x[0],x[1]))<u&&(u=w,v=r);return j[v]}i+=1}return[b,c]}function Gd(a){W.inputP.style.display="none",W.statusNode.nodeValue=W.text=a,W.statusP.style.display="block"}function Hd(a){var b;if((b=W.exec)&&"function"==typeof b)try{b(a)}catch(a){tb("PS.statusInput() callback failed ["+a.message+"]",a)}W.input.removeEventListener("keydown",Id,!1),Gd(W.text),Dc()}function Id(a){var b;return b=a.which,b||(b=a.keyCode),b===PS.KEY_ENTER?(Hd(W.input.value),Ta(a)):b!==PS.KEY_ESCAPE||(Hd(""),Ta(a))}function Jd(a,b){var c;W.statusP.style.display="none",c=a,c.length<1&&(c=">"),W.label=c,W.inputNode.nodeValue=c,W.exec=b,W.input.value="",Ec(),W.input.addEventListener("keydown",Id,!1),W.inputP.style.display="block",W.input.focus()}function Od(){var a,b,c,d,e,f,g,h;return a=new Date,b={time:a.getTime(),year:a.getFullYear(),month:a.getMonth(),date:a.getDate(),day:a.getDay(),hour24:a.getHours(),hour:0,minute:a.getMinutes(),second:a.getSeconds(),millisecond:a.getMilliseconds(),zone:a.getTimezoneOffset(),monthName:"",monthShort:"",dayName:"",dayShort:"",am_pm:"",monthStr:"",dayStr:"",minuteStr:"",secondStr:"",millisecondStr:"",timeStr:"",formal:"",abbrev:"",timestamp:""},b.monthName=Kd[b.month],b.monthShort=Ld[b.month],b.dayName=Md[b.day],b.dayShort=Nd[b.day],b.hour=b.hour24+1,b.hour24>11?(b.am_pm="PM",b.hour24>12&&(b.hour=b.hour24-12)):b.am_pm="AM",c=b.month<10?"0"+b.month:b.month.toString(),b.monthStr=c,d=b.date<10?"0"+b.date:b.date.toString(),b.dateStr=d,e=b.hour<10?"0"+b.hour:b.hour.toString(),b.hourStr=e,f=b.minute<10?"0"+b.minute:b.minute.toString(),b.minuteStr=f,g=b.second<10?"0"+b.second:b.second.toString(),b.secondStr=g,h=b.millisecond<10?"00"+b.millisecond:b.millisecond<100?"0"+b.millisecond:b.millisecond.toString(),b.millisecondStr=h,b.timeStr=e+":"+f+":"+g+"+"+h,b.formal=b.dayName+" "+d+" "+b.monthName+" "+b.year+" "+b.timeStr+" "+b.am_pm,b.abbrev=b.dayShort+" "+d+" "+b.monthShort+" "+b.year+" "+b.timeStr+" "+b.am_pm,b.timestamp=b.dayShort+"_"+d+"_"+b.monthShort+"_"+b.year+"_"+e+"_"+f+"_"+g+"_"+h+b.am_pm,b.hours24=b.hour24,b.hours=b.hour,b.minutes=b.minute,b.seconds=b.second,b.milliseconds=b.millisecond,b.string=b.abbrev,b}function Qd(){try{return document.createEvent("TouchEvent"),!0}catch(a){return!1}}function Rd(){var a,b,c,d,e;if(a=window.navigator.userAgent.toLowerCase(),b=window.navigator.platform.toLowerCase(),/firefox/.test(a)?(c="Firefox",/fennec/.test(a)&&(c+=" Mobile"),e=/firefox\/[\.\d]+/.exec(a)[0].split("/")[1]):/chrome/.test(a)?(c="Chrome",e=/chrome\/[\d\.]+/.exec(a)[0].split("/")[1]):/safari/.test(a)?(c="Safari",(/iphone/.test(a)||/ipad/.test(a)||/ipod/.test(a))&&(d="iOS")):/msie/.test(a)?(c="Internet Explorer",/iemobile/.test(a)&&(c+=" Mobile"),e=/msie \d+[.]\d+/.exec(a)[0].split(" ")[1]):/trident/.test(a)?(c="Internet Explorer",e=/rv\:\d+[.]\d+/.exec(a)[0].split(":")[1]):/opera/.test(a)?(c="Opera",/mini/.test(a)?c+=" Mini":/mobile/.test(a)&&(c+=" Mobile")):/android/.test(a)&&(c="Android",d=/android\s[\.\d]+/.exec(a)),!e)try{e=/version\/[\.\d]+/.exec(a),e=e?e[0].split("/")[1]:/opera\/[\.\d]+/.exec(a)[0].split("/")[1]}catch(a){console.error("Problem detecting browser: "+a.message),e=""}"win32"===b||"win64"===b?d="Windows":"macintel"!==b&&"macppc"!==b||(d="Mac OS X ",d+=/10[\.\_\d]+/.exec(a)[0],/[\_]/.test(d)&&(d=d.split("_").join("."))),d||(/linux/.test(b)?d="Linux":/windows/.test(a)&&(d="Windows")),I.host.app=c,e&&(I.host.version=e),I.host.os=d}function Sd(){var a,b,c,d,e,f,g;Q=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,R=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,a=p/4*5,Q>=a&&R>=a?(d=p,e=q,f=r,g=s):(b=Q/5*4,c=R/5*4,d=Math.min(b,c),d=8*Math.floor(d/8),e=q*(d/p),e=Math.floor(100*e)/100,g=s*(d/p),g=Math.floor(g),f=Math.floor(g/8)),S=d,T=e+"em",H.grid.shadow.params="0px 0px "+g+"px "+f+"px "}var J,L,M,N,Q,R,S,T,U,V,W,_,aa,ca,fa,ga,ia,ja,qa,ra,sa,ta,ua,za,Aa,Ba,Ea,Ma,Na,a="outer",b="main",c="stsp",d="inp",e="inlabel",f="inspan",g="inbox",h="grid",i="footer",j="debug",k="monitor",l="image_",m="sprite_",n="pathmap_",o="timer_",p=512,q=1.25,r=8,s=64,u=65536,v=256,w=1024,x={},y=6,z=16,A=-1,B=4,C=1.4142,D=16,E=["a0","bb0","b0","c1","db1","d1","eb1","e1","f1","gb1","g1","ab1","a1","bb1","b1","c2","db2","d2","eb2","e2","f2","gb2","g2","ab2","a2","bb2","b2","c3","db3","d3","eb3","e3","f3","gb3","g3","ab3","a3","bb3","b3","c4","db4","d4","eb4","e4","f4","gb4","g4","ab4","a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7","gb7","g7","ab7","a7","bb7","b7","c8"],F=["a2","bb2","b2","c3","db3","d3","eb3","e3","f3","gb3","g3","ab3","a3","bb3","b3","c4","db4","d4","eb4","e4","f4","gb4","g4","ab4","a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7"],G=["a4","bb4","b4","c5","db5","d5","eb5","e5","f5","gb5","g5","ab5","a5","bb5","b5","c6","db6","d6","eb6","e6","f6","gb6","g6","ab6","a6","bb6","b6","c7","db7","d7","eb7","e7","f7","gb7","g7","ab7","a7","bb7","b7"],H={grid:{width:512,x:8,y:8,max:32,plane:0,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},shadow:{show:!1,r:192,g:192,b:192,a:255,rgb:12632256,str:"rgba(192,192,192,1)",params:"0px 0px 64px 8px "},padLeft:0,padRight:0,ready:!1,timeExit:0},status:{text:"",label:"",exec:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}},fader:{active:!1,kill:!1,r:0,g:0,b:0,rgb:null,tr:0,tg:0,tb:0,trgb:0,tstr:null,step:0,rate:0,onStep:null,onEnd:null,params:null},bead:{dirty:!0,active:!0,visible:!0,planes:null,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},bgColor:{r:255,g:255,b:255,a:0,rgb:16777215,str:"rgba(255,255,255,0)"},fbgColor:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},radius:0,scale:100,minimum:8,data:0,exec:null,timeTouch:0,timeRelease:0,timeEnter:0,timeExit:0,border:{width:1,equal:!0,top:1,left:1,bottom:1,right:1,color:{r:128,g:128,b:128,a:255,rgb:8421504,str:"rgba(128,128,128,1)"},max:0,gmax:0},glyph:{str:"",code:0,scale:100,size:0,x:0,y:0,font:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}}},audio:{volume:.5,max_volume:1,path:"http://alpheus.wpi.edu/~bmoriarty/ps/audio/",loop:!1,error_sound:"fx_uhoh"}},I={engine:"Perlenspiel",major:3,minor:2,revision:17,audio:null,host:{app:"",version:"",os:""},inputs:{touch:!1},date:null},O=[],P=null,X=!1,Y=0,Z=1,$=null,ba=0,da=0,ea=!1,ha=0,ka=null,la="",ma=null,na=50,oa=1,pa=!1,va=!1,wa=!1,xa=!1,ya=!0,Ca=!1,Da=!1,Fa=!1,Ga=A,Ha=A,Ia=null,Ja=null,Ka=!1,La=!1,Oa=0,Pa=0,Va={r:0,g:0,b:0,a:0,rgb:0,str:""},Wa={r:0,g:0,b:0,a:0,rgb:0,str:""},Xa={r:0,g:0,b:0,a:0,rgb:0,str:""},Za={r:0,g:0,b:0,a:0,rgb:0,str:""},bb={rgb:0,r:0,g:0,b:0,a:255,str:""},nb=!0,ob=!1,Db={time:0},Hb={rgb:0,r:0,g:0,b:0,str:""},Lb={rgb:0,r:null,g:null,b:null,str:""},Zb={time:0},_b={time:0},bc={time:0,touching:!1},dc={time:0,touching:!1},fc={time:0,touching:!1},yc={time:0},Ac={wheel:0},Bc={time:0},Fc={time:0},Gc=!1;ud.prototype={push:function(a){this.content.push(a),this.bubbleUp(this.content.length-1)},pop:function(){var a,b;return a=this.content[0],b=this.content.pop(),this.content.length>0&&(this.content[0]=b,this.sinkDown(0)),a},remove:function(a){var b,c,d;for(b=this.content.length,c=0;c<b;c+=1)if(this.content[c]===a){d=this.content.pop(),c!==b-1&&(this.content[c]=d,this.bubbleUp(c),this.sinkDown(c));break}},size:function(){return this.content.length},bubbleUp:function(a){var b,c,d,e;for(b=this.content[a],c=this.scoreFunction(b);a>0&&(d=Math.floor((a+1)/2)-1,e=this.content[d],!(c>=this.scoreFunction(e)));)this.content[d]=b,this.content[a]=e,a=d},sinkDown:function(a){var b,c,d,e,f,g,h,i,j;for(b=this.content.length,c=this.content[a],d=this.scoreFunction(c);;){if(f=2*(a+1),e=f-1,g=null,e<b&&(h=this.content[e],(i=this.scoreFunction(h))<d&&(g=e)),f<b&&(j=this.content[f],this.scoreFunction(j)<(null===g?d:i)&&(g=f)),null===g)break;this.content[a]=this.content[g],this.content[g]=c,a=g}},rescore:function(a){this.sinkDown(this.content.indexOf(a))}};var Kd=["January","February","March","April","May","June","July","August","September","October","November","December"],Ld=["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],Md=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Nd=["SUN","MON","TUE","WED","THU","FRI","SAT"],Pd={TIME_LABEL:"time",store:{},validID:function(a){return Pd.store.hasOwnProperty(a)},expand:function(a){var b,c,d;return b=Math.floor(a/36e5),a-=36e5*b,c=Math.floor(a/6e4),a-=6e4*c,d=Math.floor(a/1e3),a-=1e3*d,{h:b,m:c,s:d,ms:a}},tstring:function(a,b){var c,d,e,f;return c=Pd.expand(a),d="",b.h>0?(c.h<10&&(d+="0"),d+=c.h+":",c.m<10&&(d+="0"),d+=c.m+":",c.s<10&&(d+="0"),d+=c.s+"."):b.m>0?(c.m<10&&(d+="0"),d+=c.m+":",c.s<10&&(d+="0"),d+=c.s+"."):b.s>0&&(c.s<10&&(d+="0"),d+=c.s+"."),e="",c.ms<10?e+="00":c.ms<100&&(e+="0"),e+=c.ms.toString(),f=e.length,1===f?e+="00":2===f&&(e+="0"),d+=e},csv:function(a,b){var c,d,e,f,g,h,i,j,k,l,m;if(c=Pd.store[b],(d=c.events.length)<1)return ub(a+"Database '"+b+"' is empty");for(e=c.fields.length,f=Pd.expand(c.tmax),g=Pd.TIME_LABEL+",",i=e-1,h=0;h<e;h+=1)j=c.fields[h],g+=j,h<i&&(g+=",");for(g+="\r\n",h=0;h<d;h+=1){for(k=c.events[h],g+=Pd.tstring(k[Pd.TIME_LABEL],f),g+=",",l=0;l<e;l+=1)j=c.fields[l],k.hasOwnProperty(j)&&(m=k[j],g+=m.toString()),l<i&&(g+=",");g+="\r\n"}return g},init:function(a,b,c){return Pd.store[a]={name:a,date:Od(),fields:[],events:[],tmax:0,user:b,discard:c},c||(Pa<1&&window.addEventListener("beforeunload",Hc,!1),Pa+=1),a},erase:function(a){var b;b=Pd.store[a],b.discard||(Pa-=1)<1&&window.removeEventListener("beforeunload",Hc,!1),delete Pd.store[a]},event:function(a,b){var c,d,e,f,g,h,i;for(c=Pd.store[a],d=new Date,e=d.getTime()-c.date.time,f={},f[Pd.TIME_LABEL]=e,c.tmax=e,g=b.length,h=0;h<g;h+=2)i=b[h],c.fields.indexOf(i)<0&&c.fields.push(i),f[i]=b[h+1];return c.events.push(f),e},emails:function(a,b,c,d,e){var f,g,h,i,j,k;return f=Pd.store[b],(g=Pd.csv(a,b))===PS.ERROR?PS.ERROR:(h={id:b,timestamp:f.date.timestamp,csv:g,user:f.user||d,bcc:null},i=function(c){if(c.error)return ub(a,c.error);e&&(k=e.message,k&&"string"==typeof k&&k.length>0&&Gb(k),e.discard&&Pd.erase(b))},j=K.PS.sendVerifiedEmails(c,h,i,Gc),j!==K.OK?j:b)}};PS={ALL:"PS.ALL",CURRENT:"PS.CURRENT",DONE:"PS.DONE",DEFAULT:"PS.DEFAULT",ERROR:"PS.ERROR",EMPTY:"PS.EMPTY",UNEQUAL:"PS.UNEQUAL",GRID:"PS.GRID",STATUS:"PS.STATUS",HTML5_AUDIO:"PS.HTML5_AUDIO",WEB_AUDIO:"PS.WEB_AUDIO",SPRITE_TOUCH:"PS.SPRITE_TOUCH",SPRITE_OVERLAP:"PS.SPRITE_OVERLAP",COLOR_BLACK:0,COLOR_WHITE:16777215,COLOR_GRAY_LIGHT:12632256,COLOR_GRAY:8421504,COLOR_GRAY_DARK:4210752,COLOR_RED:16711680,COLOR_ORANGE:16744448,COLOR_YELLOW:16776960,COLOR_GREEN:65280,COLOR_BLUE:255,COLOR_INDIGO:4194559,COLOR_VIOLET:8388863,COLOR_MAGENTA:16711935,COLOR_CYAN:65535,ALPHA_OPAQUE:255,ALPHA_TRANSPARENT:0,KEY_ENTER:13,KEY_TAB:9,KEY_ESCAPE:27,KEY_ARROW_LEFT:1005,KEY_ARROW_UP:1006,KEY_ARROW_RIGHT:1007,KEY_ARROW_DOWN:1008,KEY_DELETE:1010,KEY_PAD_0:96,KEY_PAD_1:97,KEY_PAD_2:98,KEY_PAD_3:99,KEY_PAD_4:100,KEY_PAD_5:101,KEY_PAD_6:102,KEY_PAD_7:103,KEY_PAD_8:104,KEY_PAD_9:105,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,WHEEL_FORWARD:"PS.WHEEL_FORWARD",WHEEL_BACKWARD:"PS.WHEEL_BACKWARD",FINDER_ASTAR:"PS.FINDER_ASTAR",FINDER_BREADTH_FIRST:"PS.FINDER_BREADTH_FIRST",FINDER_BEST_FIRST:"PS.FINDER_BEST_FIRST",FINDER_DIJKSTRA:"PS.FINDER_DIJKSTRA",FINDER_BI_ASTAR:"PS.FINDER_BI_ASTAR",FINDER_BI_BEST_FIRST:"PS.FINDER_BI_BEST_FIRST",FINDER_BI_DIJKSTRA:"PS.FINDER_BI_DIJKSTRA",FINDER_BI_BREADTH_FIRST:"PS.FINDER_BI_BREADTH_FIRST",FINDER_JUMP_POINT:"PS.FINDER_JUMP_POINT",_lastTick:0,_clock:function(){ea&&(window.requestAnimationFrame(PS._clock),Eb())},_sys:function(){var l,m,n,o,p,q,r,s,t,u,v,x,z,A,B,C;for(l="[PS.sys] ",String.fromCodePoint||(String.fromCodePoint=Ua),Z=Math.floor(1e6*Math.random())+1,J=[],J.length=256,L=[],L.length=256,M=[],M.length=256,N=[],N.length=256,m=0;m<256;m+=1)J[m]="rgba("+m+",",L[m]=m+",",M[m]=m+",1)",x=Math.max(0,Math.min(m/255,1)),O[m]=x,N[m]=x+")";if(Rd(),Sd(),Ca=Qd(),I.inputs.touch=Ca,document.body.id="body",document.body.style.backgroundColor=H.grid.color.str,n=document.getElementById(a),n||(n=document.createElement("div"),n.id=a,document.body.appendChild(n)),P=document.getElementById(b),P||(P=document.createElement("div"),P.id=b,n.appendChild(P)),P.style.width=S+"px",PS._mainLeft=P.offsetLeft,PS._mainTop=P.offsetTop,o=document.getElementById(c),o||(o=document.createElement("p"),o.id=c,P.appendChild(o)),o.style.fontSize=T,p=document.createTextNode(""),o.appendChild(p),q=document.getElementById(d),q||(q=document.createElement("p"),q.id=d,P.appendChild(q)),q.style.fontSize=T,s=document.getElementById(e),s||(s=document.createElement("span"),s.id=e,q.appendChild(s)),r=document.createTextNode(""),s.appendChild(r),s=document.getElementById(f),s||(s=document.createElement("span"),s.id=f,q.appendChild(s)),t=document.getElementById(g),t||(t=document.createElement("input"),t.id=g,s.appendChild(t)),t.tabindex=0,t.wrap="soft",W={statusP:o,statusNode:p,inputP:q,inputNode:r,input:t,fader:yb(c,fb,null),text:"",label:"",exec:null,color:{r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}},Gd("Perlenspiel "+I.major+"."+I.minor),!(u=document.getElementById(h))){if(!(u=document.createElement("canvas")))return void window.alert(l+"HTML5 canvas not supported.");u.id=h,P.appendChild(u)}for(u.width=S,u.style.backgroundColor=H.grid.color.str,Fa=!1,hc(),ka=document.getElementById(i),ka||(ka=document.createElement("p"),ka.id=i,P.appendChild(ka)),sb("Loading Perlenspiel"),Ia=document.getElementById(j),Ia||(Ia=document.createElement("div"),Ia.id=j,P.appendChild(Ia)),Ja=document.getElementById(k),Ja||(Ja=document.createElement("textarea"),Ja.id=k,Ia.appendChild(Ja)),Ja.rows=8,Ja.wrap="soft",Ja.readonly="readonly",Ja.onfocus=function(){La=!0},Ja.onblur=function(){La=!1},Ja.addEventListener("mousedown",lc,!1),Ja.addEventListener("mouseup",mc,!1),Ka=!1,La=!1,pa=!1,ta=[],qa=[],ra=[],sa=[],m=0;m<256;m+=1)ta[m]=0,qa[m]=m,ra[m]=m,sa[m]=m;for(ua=[],va=!1,wa=!1,xa=!1,ya=!0,Aa=y,Ba=5*y,qa[33]=PS.KEY_PAGE_UP,qa[34]=PS.KEY_PAGE_DOWN,qa[35]=PS.KEY_END,qa[36]=PS.KEY_HOME,qa[37]=PS.KEY_ARROW_LEFT,qa[38]=PS.KEY_ARROW_UP,qa[39]=PS.KEY_ARROW_RIGHT,qa[40]=PS.KEY_ARROW_DOWN,qa[45]=PS.KEY_INSERT,qa[46]=PS.KEY_DELETE,qa[188]=44,qa[190]=46,qa[191]=47,qa[192]=96,qa[219]=91,qa[220]=92,qa[221]=93,qa[222]=39,ra[96]=126,ra[49]=33,ra[50]=64,ra[51]=35,ra[52]=36,ra[53]=37,ra[54]=94,ra[55]=38,ra[56]=42,ra[57]=40,ra[48]=41,ra[45]=95,ra[61]=43,ra[91]=123,ra[93]=125,ra[92]=124,ra[59]=58,ra[39]=34,ra[44]=60,ra[46]=62,ra[47]=63,m=65;m<91;m+=1)sa[m]=m+32;sa[126]=96,sa[33]=49,sa[64]=50,sa[35]=51,sa[36]=52,sa[37]=53,sa[94]=54,sa[38]=55,sa[42]=56,sa[40]=57,sa[41]=48,sa[95]=45,sa[43]=51,sa[123]=91,sa[125]=93,sa[124]=92,sa[58]=59,sa[34]=39,sa[60]=44,sa[62]=46,sa[63]=47,window.onblur=uc(),v=u.getContext("2d"),v.constructor.prototype.fillRoundedRect||(v.constructor.prototype.fillRoundedRect=function(a,b,c,d,e,f,g){void 0===e&&(e=5),this.beginPath(),"Opera"===I.host.app?(this.moveTo(a+c-e,b),this.arcTo(a+e,b,a,b+e,e),this.arcTo(a,b+d-e,a+e,b+d,e),this.arcTo(a+c-e,b+d,a+c,b+d-e,e),this.arcTo(a+c,b+e,a+c-e,b,e)):(this.moveTo(a+e,b),this.arcTo(a+c,b,a+c,b+d,e),this.arcTo(a+c,b+d,a,b+d,e),this.arcTo(a,b+d,a,b,e),this.arcTo(a,b,a+c,b,e)),this.closePath(),g?this.stroke():(f||void 0===f)&&this.fill()}),v.constructor.prototype.fillCircle||(v.constructor.prototype.fillCircle=function(a,b,c,d,e,f){var g;g=c/2,this.beginPath(),this.arc(a+g,b+g,g,0,2*Math.PI,!0),this.closePath(),f?this.stroke():(e||void 0===e)&&this.fill()}),U={canvas:u,context:v,fader:yb(h,cb,db),width:512,x:8,y:8,max:32,plane:0,color:{r:255,g:255,b:255,a:255,rgb:16777215,str:"rgba(255,255,255,1)"},shadow:{show:!1,r:192,g:192,b:192,a:255,rgb:12632256,str:"rgba(192,192,192,1)",params:"0px 0px 64px 8px "},padLeft:0,padRight:0,ready:!1,timeExit:0};var D=window.getComputedStyle(U.canvas,null);for(U.padLeft=parseInt(D.getPropertyValue("padding-top").replace("px",""),10),U.padRight=parseInt(D.getPropertyValue("padding-left").replace("px",""),10),V=[],V.length=x=w,m=0;m<x;m+=1)z={index:m,fader:yb(m,gb,null),borderFader:yb(m,hb,null),glyphFader:yb(m,ib,null)},Ob(z),V[m]=z;if(ca=[],da=0,Na=[],Oa=0,A=null,"iOS"!==I.host.os){if((A=AQ.init({defaultPath:H.audio.path,defaultFileTypes:["ogg","mp3","wav"],onAlert:PS.debug,stack:!0,forceHTML5:!0}))===PS.ERROR||A.status===AQ.ERROR)return;I.audio=A,Ma=null,B=PS.audioLoad(H.audio.error_sound,{path:H.audio.path,lock:!0}),B===PS.ERROR?mb("Error sound '"+H.audio.error_sound+"' not loaded"):Ma=H.audio.error_sound}if(_=document.createElement("canvas"),v=_.getContext("2d"),v.imageSmoothingEnabled=!1,v.mozImageSmoothingEnabled=!1,v.webkitImageSmoothingEnabled=!1,aa=[],ba=0,C="() function invalid; will be ignored",PS.init&&"function"!=typeof PS.init&&(PS.init=null,mb("PS.init"+C)),PS.touch&&"function"!=typeof PS.touch&&(PS.touch=null,mb("PS.touch"+C)),PS.release&&"function"!=typeof PS.release&&(PS.release=null,mb("PS.release"+C)),PS.enter&&"function"!=typeof PS.enter&&(PS.enter=null,mb("PS.enter"+C)),PS.exit&&"function"!=typeof PS.exit&&(PS.exit=null,mb("PS.exit"+C)),PS.exitGrid&&"function"!=typeof PS.exitGrid&&(PS.exitGrid=null,mb("PS.exitGrid"+C)),PS.keyDown&&"function"!=typeof PS.keyDown&&(PS.keyDown=null,mb("PS.keyDown"+C)),PS.keyUp&&"function"!=typeof PS.keyUp&&(PS.keyUp=null,mb("PS.keyUp"+C)),PS.input&&"function"!=typeof PS.input&&(PS.input=null,mb("PS.input"+C)),PS.swipe&&"function"!=typeof PS.swipe&&(PS.swipe=null,mb("PS.swipe"+C)),PS.shutdown&&"function"!=typeof PS.shutdown&&(PS.shutdown=null,mb("PS.shutdown"+C)),Lc(H.grid.x,H.grid.y),wb(),Cb(),ea=!0,fa=0,PS._clock(),C="PS "+I.major+"."+I.minor+"."+I.revision+" | ",A&&(C+=A.engine+" "+A.major+"."+A.minor+"."+A.revision+" | "),K&&(B=K.PS.init())&&(C+=B.name+" "+B.major+"."+B.minor+"."+B.revision+" | "),C+=I.host.os+" "+I.host.app+" "+I.host.version,Ca&&(C+=" | Touch "),Gb(C),Ic(),PS.init){I.date=Od();try{PS.init(I,{time:fa}),kb()}catch(a){tb("PS.init() failed ["+a.message+"]",a)}}},gridSize:function(a,b){var c,d,e,f;if(c="[PS.gridSize] ",arguments.length>2)return ub(c+"Too many arguments");if(d=a,e=b,f=H.grid.max,d===PS.DEFAULT)d=H.grid.x;else if(d===PS.CURRENT)d=U.x;else{if("number"!==Qa(d))return ub(c+"x argument invalid");d=Math.floor(d),d<1?d=1:d>f&&(d=f)}if(e===PS.DEFAULT)e=H.grid.y;else if(e===PS.CURRENT)e=U.y;else{if("number"!==Qa(e))return ub(c+"y argument invalid");e=Math.floor(e),e<1?e=1:e>f&&(e=f)}return Lc(d,e),{width:U.x,height:U.y}},gridPlane:function(a){var b,c,d;if(b="[PS.gridPlane] ",arguments.length>1)return ub(b+"Too many arguments");if(c=a,"undefined"!==(d=Qa(c))&&c!==PS.CURRENT){if(c===PS.DEFAULT)c=0;else{if("number"!==d)return ub(b+"plane argument invalid");(c=Math.floor(c))<1&&(c=0)}U.plane=c}return U.plane},gridColor:function(a,b,c){var d,e;return d="[PS.gridColor] ",arguments.length>3?ub(d+"Too many arguments"):(e=Mb(d,a,b,c),e===PS.ERROR?PS.ERROR:Jc(e))},gridFade:function(a,b){var c,d,e,f,g,h,i,j;if(c="[PS.gridFade] ",arguments.length>2)return ub(c+"Too many arguments");if(e=U.color,d=U.fader,f=d.rate,"undefined"===(i=Qa(a))||a===PS.CURRENT)g=f;else if(a===PS.DEFAULT)g=H.fader.rate;else{if("number"!==i)return ub(c+"rate argument invalid");(g=Math.floor(a))<0&&(g=0)}return(h=Rc(c,b))===PS.ERROR?PS.ERROR:(j=h.rgb,j!==PS.CURRENT&&(j===PS.DEFAULT?d.rgb=H.fader.rgb:d.rgb=j,d.r=h.r,d.g=h.g,d.b=h.b),j=h.onStep,j!==PS.CURRENT&&(j===PS.DEFAULT?d.onStep=H.fader.onStep:d.onStep=j),j=h.onEnd,j!==PS.CURRENT&&(j===PS.DEFAULT?d.onEnd=H.fader.onEnd:d.onEnd=j),j=h.params,j!==PS.CURRENT&&(j===PS.DEFAULT?d.params=H.fader.params:d.params=j),f!==g&&(d.rate=g,g<1?(d.active=!1,d.kill=!0):d.active&&Bb(d,e.r,e.g,e.b,255)),{rate:d.rate,rgb:d.rgb,onStep:d.onStep,onEnd:d.onEnd,params:d.params})},gridShadow:function(a,b,c,d){var e,f,g;if(e="[PS.gridShadow] ",arguments.length>4)return ub(e+"Too many arguments");if(!0!==(f=a)&&!1!==f&&f!==PS.CURRENT)if(null===f||f===PS.DEFAULT)f=!1;else{if("number"!==Qa(f))return ub(e+"First argument invalid");f=0!==f}return g=Mb(e,b,c,d),g===PS.ERROR?PS.ERROR:Kc(f,g)},gridRefresh:function(){var a;return a="[PS.gridRefresh] ",arguments.length>0?ub(a+"Too many arguments"):(kb(),Y)},color:function(a,b,c,d,e){var f,g,h;return f="[PS.color] ",(g=arguments.length)<2?ub(f+"Missing argument(s)"):g>5?ub(f+"Too many arguments"):(h=Mb(f,c,d,e),h===PS.ERROR?PS.ERROR:Oc(f,Pc,a,b,h))},alpha:function(a,b,c){var d,e,f,g;if(d="[PS.alpha] ",(e=arguments.length)<2)return ub(d+"Missing argument(s)");if(e>3)return ub(d+"Too many arguments");if((f=c)!==PS.CURRENT)if("undefined"===(g=Qa(f)))f=PS.CURRENT;else if("number"===g)f=Math.floor(f),f<0?f=0:f>255&&(f=255);else{if(f!==PS.DEFAULT)return ub(d+"alpha argument invalid");f=H.bead.color.a}return Oc(d,Qc,a,b,f)},fade:function(a,b,c,d){var e,f,g,h,i;if(e="[PS.fade] ",(f=arguments.length)<2)return ub(e+"Missing argument(s)");if(f>4)return ub(e+"Too many arguments");if((g=c)!==PS.CURRENT&&g!==PS.DEFAULT)if("undefined"===(h=Qa(g)))g=PS.CURRENT;else{if("number"!==h)return ub(e+"rate argument invalid");(g=Math.floor(g))<0&&(g=0)}return i=Rc(e,d),i===PS.ERROR?PS.ERROR:Oc(e,Sc,a,b,g,i)},scale:function(a,b,c){var d,e,f,g;if(d="[PS.scale] ",(e=arguments.length)<2)return ub(d+"Missing argument(s)");if(e>3)return ub(d+"Too many arguments");if((f=c)!==PS.CURRENT)if("undefined"===(g=Qa(f)))f=PS.CURRENT;else if(f===PS.DEFAULT)f=100;else{if("number"!==g)return ub(d+"scale parameter invalid");f=Math.floor(f),f<50?f=50:f>100&&(f=100)}return Oc(d,Tc,a,b,f)},radius:function(a,b,c){var d,e,f,g;if(d="[PS.radius] ",(e=arguments.length)<2)return ub(d+"Missing argument(s)");if(e>3)return ub(d+"Too many arguments");if((f=c)!==PS.CURRENT)if("undefined"===(g=Qa(f)))f=PS.CURRENT;else if(f===PS.DEFAULT)f=0;else{if("number"!==g)return ub(d+"radius parameter invalid");f=Math.floor(f),f<0?f=0:f>50&&(f=50)}return Oc(d,Uc,a,b,f)},bgColor:function(a,b,c,d,e){var f,g,h;return f="[PS.bgColor] ",(g=arguments.length)<2?ub(f+"Missing argument(s)"):g>5?ub(f+"Too many arguments"):(h=Mb(f,c,d,e),h===PS.ERROR?PS.ERROR:Oc(f,Vc,a,b,h))},bgAlpha:function(a,b,c){var d,e,f,g;if(d="[PS.bgAlpha] ",(e=arguments.length)<2)return ub(d+"Missing argument(s)");if(e>3)return ub(d+"Too many arguments");if((f=c)!==PS.CURRENT)if("undefined"===(g=Qa(f)))f=PS.CURRENT;else if("number"===g)f=Math.floor(f),f<0?f=0:f>255&&(f=255);else{if(f!==PS.DEFAULT)return ub(d+"alpha argument invalid");f=H.bead.bgColor.a}return Oc(d,Wc,a,b,f)},data:function(a,b,c){var d,e,f;return d="[PS.data] ",(e=arguments.length)<2?ub(d+"Missing argument(s)"):e>3?ub(d+"Too many arguments"):(f=c,void 0===f?f=PS.CURRENT:f===PS.DEFAULT&&(f=null),Oc(d,Xc,a,b,f))},exec:function(a,b,c){var d,e,f,g;if(d="[PS.exec] ",(e=arguments.length)<2)return ub(d+"Missing argument(s)");if(e>3)return ub(d+"Too many arguments");if((f=c)!==PS.CURRENT)if("undefined"===(g=Qa(f)))f=PS.CURRENT;else if(f===PS.DEFAULT)f=H.bead.exec;else if("function"!==g)return ub(d+"exec argument invalid");return Oc(d,Yc,a,b,f)},visible:function(a,b,c){var d,e,f;return d="[PS.visible] ",(e=arguments.length)<2?ub(d+"Missing argument(s)"):e>3?ub(d+"Too many arguments"):(f=Sa(c,PS.CURRENT,!0,PS.CURRENT),f===PS.ERROR?ub(d+"show argument invalid"):Oc(d,Zc,a,b,f))},active:function(a,b,c){var d,e,f;return d="[PS.active] ",(e=arguments.length)<2?ub(d+"Missing argument(s)"):e>3?ub(d+"Too many arguments"):(f=Sa(c,PS.CURRENT,!0,PS.CURRENT),f===PS.ERROR?ub(d+"active argument invalid"):Oc(d,$c,a,b,f))},minimum:function(a,b,c){var d,e,f;if(d="[PS.minimum] ",(e=arguments.length)<2)return ub(d+"Missing argument(s)");if(e>3)return ub(d+"Too many arguments");if((f=c)!==PS.CURRENT)if(void 0===f)f=PS.CURRENT;else if(f===PS.DEFAULT)f=H.bead.minimum;else{if("number"!==Qa(f))return ub(d+"minimum argument invalid");f=Math.floor(f),f<0?f=0:f>p&&(f=p)}return Oc(d,_c,a,b,f)},border:function(a,b,c){var d,e,f,g,h,i;if(d="[PS.border] ",(e=arguments.length)<2)return ub(d+"Missing argument(s)");if(e>3)return ub(d+"Too many arguments");if(f=H.bead.border,(g=c)!==PS.CURRENT)if("undefined"===(h=Qa(g)))g=PS.CURRENT;else if(g===PS.DEFAULT)g=f.width;else if("number"===h)(g=Math.floor(g))<0&&(g=0);else{if("object"!==h)return ub(d+"width argument invalid");if((i=g.top)!==PS.CURRENT)if("undefined"===(h=Qa(i)))g.top=PS.CURRENT;else if("number"===h)i=Math.floor(i),i<0&&(i=0),g.top=i;else{if(i!==PS.DEFAULT)return ub(d+".top property invalid");g.top=f.top}if((i=g.left)!==PS.CURRENT)if("undefined"===(h=Qa(i)))g.left=PS.CURRENT;else if("number"===h)i=Math.floor(i),i<0&&(i=0),g.left=i;else{if(i!==PS.DEFAULT)return ub(d+".left property invalid");g.left=f.left}if((i=g.bottom)!==PS.CURRENT)if("undefined"===(h=Qa(i)))g.bottom=PS.CURRENT;else if("number"===h)i=Math.floor(i),i<0&&(i=0),g.bottom=i;else{if(i!==PS.DEFAULT)return ub(d+".bottom property invalid");g.bottom=f.bottom}if((i=g.right)!==PS.CURRENT)if("undefined"===(h=Qa(i)))g.right=PS.CURRENT;else if("number"===h)i=Math.floor(i),i<0&&(i=0),g.right=i;else{if(i!==PS.DEFAULT)return ub(d+".right property invalid");g.right=f.right}}return Oc(d,ad,a,b,g)},borderColor:function(a,b,c,d,e){var f,g;return f="[PS.borderColor] ",arguments.length<2?ub(f+"Missing argument(s)"):arguments.length>5?ub(f+"Too many arguments"):(g=Mb(f,c,d,e),g===PS.ERROR?PS.ERROR:Oc(f,bd,a,b,g))},borderAlpha:function(a,b,c){var d,e,f,g;if(d="[PS.borderAlpha] ",(e=arguments.length)<2)return ub(d+"Missing argument(s)");if(e>3)return ub(d+"Too many arguments");if((f=c)!==PS.CURRENT)if("undefined"===(g=Qa(f)))f=PS.CURRENT;else if("number"===g)f=Math.floor(f),f<0?f=0:f>255&&(f=255);else{if(f!==PS.DEFAULT)return ub(d+"alpha argument invalid");f=H.bead.border.color.a}return Oc(d,cd,a,b,f)},borderFade:function(a,b,c,d){var e,f,g,h,i;if(e="[PS.borderFade] ",(f=arguments.length)<2)return ub(e+"Missing argument(s)");if(f>4)return ub(e+"Too many arguments");if((g=c)!==PS.CURRENT&&g!==PS.DEFAULT)if("undefined"===(h=Qa(g)))g=PS.CURRENT;else{if("number"!==h)return ub(e+"rate argument not a number");(g=Math.floor(g))<0&&(g=0)}return i=Rc(e,d),i===PS.ERROR?PS.ERROR:Oc(e,dd,a,b,g,i)},glyph:function(a,b,c){var d,e,f,g;if(d="[PS.glyph] ",(e=arguments.length)<2)return ub(d+"Missing argument(s)");if(e>3)return ub(d+"Too many arguments");if((f=c)!==PS.CURRENT)if("undefined"===(g=Qa(f)))f=PS.CURRENT;else if(f===PS.DEFAULT)f=0;else if("string"===g)f=f.length>0?f.charCodeAt(0):0;else{if("number"!==g)return ub(d+"glyph argument invalid");(f=Math.floor(f))<1&&(f=0)}return Oc(d,ed,a,b,f)},glyphColor:function(a,b,c,d,e){var f,g;return f="[PS.glyphColor] ",arguments.length<2?ub(f+"Missing argument(s)"):arguments.length>5?ub(f+"Too many arguments"):(g=Mb(f,c,d,e),g===PS.ERROR?PS.ERROR:Oc(f,fd,a,b,g))},glyphAlpha:function(a,b,c){var d,e,f,g;if(d="[PS.glyphAlpha] ",(e=arguments.length)<2)return ub(d+"Missing argument(s)");if(e>3)return ub(d+"Too many arguments");if((f=c)!==PS.CURRENT)if("undefined"===(g=Qa(f)))f=PS.CURRENT;else if("number"===g)f=Math.floor(f),f<0?f=0:f>255&&(f=255);else{if(f!==PS.DEFAULT)return ub(d+"alpha argument invalid");f=H.bead.glyph.color.a}return Oc(d,gd,a,b,f)},glyphScale:function(a,b,c){var d,e,f,g;if(d="[PS.glyphScale] ",(e=arguments.length)<2)return ub(d+"Missing argument(s)");if(e>3)return ub(d+"Too many arguments");if((f=c)!==PS.CURRENT)if("undefined"===(g=Qa(f)))f=PS.CURRENT;else if("number"===g)f=Math.floor(f),f<50?f=50:f>100&&(f=100);else{if(f!==PS.DEFAULT)return ub(d+"scale argument invalid");f=H.bead.glyph.scale}return Oc(d,hd,a,b,f)},glyphFade:function(a,b,c,d){var e,f,g,h,i;if(e="[PS.glyphFade] ",(f=arguments.length)<2)return ub(e+"Missing argument(s)");if(f>4)return ub(e+"Too many arguments");if((g=c)!==PS.CURRENT&&g!==PS.DEFAULT)if("undefined"===(h=Qa(g)))g=PS.CURRENT;else{if("number"!==h)return ub(e+"rate argument not a number");(g=Math.floor(g))<0&&(g=0)}return i=Rc(e,d),i===PS.ERROR?PS.ERROR:Oc(e,id,a,b,g,i)},statusText:function(a){var b,c,d;return b="[PS.statusText] ",arguments.length>1?ub(b+"Too many arguments"):(c=a,d=Qa(c),c!==PS.CURRENT&&"undefined"!==d&&(c===PS.DEFAULT?c=H.status.text:"string"!==d&&(c=c.toString()),Gd(c)),W.text)},statusInput:function(a,b){var c,d,e;return c="[PS.statusInput] ",2!==arguments.length?ub(c+"Expected 2 arguments"):b&&"function"==typeof b?(d=a.toString(),e=a.length,e>D&&(d=d.substring(0,D)),Jd(d,b),W.label):ub(c+"function argument invalid")},statusColor:function(a,b,c){var d,e,f,g,h,i,j,k,l;return d="[PS.statusColor] ",arguments.length>3?ub(d+"Too many arguments"):(e=Mb(d,a,b,c))===PS.ERROR?PS.ERROR:(f=W.color,g=H.status.color,h=W.fader,i=e.rgb,i!==PS.CURRENT&&(null===i?(j=e.r,j===PS.CURRENT?e.r=j=f.r:j===PS.DEFAULT&&(e.r=j=g.r),k=e.g,k===PS.CURRENT?e.g=k=f.g:k===PS.DEFAULT&&(e.g=k=g.g),l=e.b,l===PS.CURRENT?e.b=l=f.b:l===PS.DEFAULT&&(e.b=l=g.b),e.rgb=j*u+k*v+l):i===PS.DEFAULT&&(e={r:0,g:0,b:0,a:255,rgb:0,str:"rgba(0,0,0,1)"}),(f.rgb!==e.rgb||h.rate>0&&null!==h.rgb&&h.rgb!==e.rgb)&&(f.rgb=e.rgb,j=e.r,k=e.g,l=e.b,f.str=e.str=J[j]+L[k]+M[l],h.rate>0?(null!==h.rgb&&Ab(h,h.r,h.g,h.b,255,j,k,l,255),h.active?Bb(h,j,k,l,255):Ab(h,f.r,f.g,f.b,255,j,k,l,255)):fb(f),f.r=j,f.g=k,f.b=l)),f.rgb)},statusFade:function(a,b){var c,d,e,f,g,h,i,j;if(c="[PS.statusFade] ",arguments.length>2)return ub(c+"Too many arguments");if(e=W.color,d=W.fader,f=d.rate,"undefined"===(h=Qa(a))||a===PS.CURRENT)g=f;else if(a===PS.DEFAULT)g=H.fader.rate;else{if("number"!==h)return ub(c+"rate argument invalid");(g=Math.floor(a))<0&&(g=0)}return(j=Rc(c,b))===PS.ERROR?PS.ERROR:(i=j.rgb,i!==PS.CURRENT&&(i===PS.DEFAULT?d.rgb=H.fader.rgb:d.rgb=i,d.r=j.r,d.g=j.g,d.b=j.b),i=j.onStep,i!==PS.CURRENT&&(i===PS.DEFAULT?d.onStep=H.fader.onStep:d.onStep=i),i=j.onEnd,i!==PS.CURRENT&&(i===PS.DEFAULT?d.onEnd=H.fader.onEnd:d.onEnd=i),i=j.params,i!==PS.CURRENT&&(i===PS.DEFAULT?d.params=H.fader.params:d.params=i),f!==g&&(d.rate=g,g<1?(d.active=!1,d.kill=!0):d.active&&Bb(d,e.r,e.g,e.b,255)),{rate:d.rate,rgb:d.rgb,onStep:d.onStep,onEnd:d.onEnd,params:d.params})},_footerFade:function(a){Gb(a)},timerStart:function(a,b){var c,d,e,f,h,i,j,k,l;if(c="[PS.timerStart] ",(d=arguments.length)<2)return ub(c+"Argument(s) missing");if(e=a,f=b,e===PS.DEFAULT)e=60;else{if("number"!==Qa(e))return ub(c+"ticks argument invalid");if((e=Math.floor(e))<1)return ub(c+"ticks argument less than one (1)")}if("function"!=typeof f)return ub(c+"exec argument not a function");if(i=[],d>2)for(k=d-2,i.length=k,j=0;j<k;j+=1)i[j]=arguments[j+2];return l=o+ha,ha+=1,h={id:l,delay:e,count:e,exec:f,arglist:i},ga.push(h),l},timerStop:function(a){var b,d,e,f;if(b="[PS.timerStop] ",arguments.length<1)return ub(b+"Argument missing");if(!a||"string"!=typeof a||a.length<1)return ub(b+"id argument invalid");for(e=ga.length,d=0;d<e;d+=1)if(f=ga[d],f.id===a)return ga.splice(d,1),a;return ub(b+"timer id '"+a+"' not found")},random:function(a){var b,c,d;return b="[PS.random] ",arguments.length<1?ub(b+"Argument missing"):(d=a,"number"!==Qa(d)?ub(b+"Argument not a number"):(d=Math.floor(d))<2?1:(c=function(){var a;return a=1e4*Math.sin(Z),Z+=1,a-Math.floor(a)},d=c()*d,d=Math.floor(d)+1))},seed:function(a){var b,c;return b="[PS.seed] ",arguments.length<1?ub(b+"Argument missing"):(c=a,"number"!==Qa(c)?ub(b+"Argument not a number"):(c=Math.floor(c),c<1&&(c=1),Z=c))},makeRGB:function(a,b,c){var d,e,f,g,h;return d="[PS.makeRGB] ",(e=arguments.length)<3?ub(d+"Argument(s) missing"):e>3?ub(d+"Too many arguments"):(f=a,g=b,h=c,"number"!==Qa(f)?ub(d+"r argument not a number"):(f=Math.floor(f),f<0?f=0:f>255&&(f=255),"number"!==Qa(g)?ub(d+"g argument not a number"):(g=Math.floor(g),g<0?g=0:g>255&&(g=255),"number"!==Qa(h)?ub(d+"b argument not a number"):(h=Math.floor(h),h<0?h=0:h>255&&(h=255),f*u+g*v+h))))},unmakeRGB:function(a,b){var c,d,e,f,g,h,i,j,k,l;if(c="[PS.unmakeRGB] ",(d=arguments.length)<2)return ub(c+"Missing argument(s)");if(d>2)return ub(c+"Too many arguments");if(e=a,f=b,"number"!==Qa(e))return ub(c+"rgb argument not a number");if(e=Math.floor(e),e<1?(e=0,g=0,h=0,i=0):e>=16777215?(e=16777215,g=255,h=255,i=255):(g=e/u,g=Math.floor(g),j=g*u,h=(e-j)/v,h=Math.floor(h),k=h*v,i=e-j-k),"object"===(l=Qa(f)))f.rgb=e,f.r=g,f.g=h,f.b=i;else{if("array"!==l)return ub(c+"result argument not an array or object reference");f.length<3&&(f.length=3),f[0]=g,f[1]=h,f[2]=i}return f},applyRect:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(f="[PS.applyRect] ",(g=arguments.length)<5)return ub(f+"Argument(s) missing");if(h=U.x,i=U.y,j=a,k=b,l=c,m=d,n=e,j===PS.DEFAULT)j=0;else{if("number"!==Qa(j))return ub(f+"left argument invalid");if((j=Math.floor(j))>=h)return PS.DONE;j<0&&(j=0)}if(k===PS.DEFAULT)k=0;else{if("number"!==Qa(k))return ub(f+"top argument invalid");if((k=Math.floor(k))>=i)return PS.DONE;k<0&&(k=0)}if(l===PS.DEFAULT)l=h-j;else{if("number"!==Qa(l))return ub(f+"width argument invalid");if((l=Math.floor(l))<1)return PS.DONE;j+l>h&&(l=h-j)}if(o=j+l,m===PS.DEFAULT)m=i-k;else{if("number"!==Qa(m))return ub(f+"height argument invalid");if((m=Math.floor(m))<1)return PS.DONE;k+m>i&&(m=i-k)}if(p=k+m,!n||"function"!=typeof n)return ub(f+"exec argument not a function");if(t=[0,0],g>5)for(u=g-5,v=0;v<u;v+=1)t.push(arguments[v+5]);for(r=k;r<p;r+=1)for(t[1]=r,q=j;q<o;q+=1){t[0]=q;try{s=n.apply(x,t)}catch(a){s=tb(f+"exec failed @"+q+", "+r+" ["+a.message+"]",a)}if(s===PS.ERROR)return PS.ERROR}return s},hex:function(a,b){var c,d,e,f;if(c="[PS.hex] ",d=a,"number"!==(e=Qa(d)))return ub(c+"value argument invalid");if(d=Math.floor(d),d=Math.abs(d),f=b,"undefined"===(e=Qa(f))||f===PS.DEFAULT)f=2;else{if("number"!==e)return ub(c+"padding argument invalid");(f=Math.floor(f))<1&&(f=1)}return nd(d,f)},keyRepeat:function(a,b,c){var d,e,f,g,h;if(d="[PS.keyRepeat] ",(f=Sa(a,ya,!0,!0))===PS.ERROR)return ub(d+"repeat argument invalid");if(h=b,"undefined"===(e=Qa(h))||h===PS.DEFAULT)h=5*y;else if(h===PS.CURRENT)h=Ba;else{if("number"!==e)return ub(d+"init argument invalid");(h=Math.floor(h))<1&&(h=1)}if(g=c,"undefined"===(e=Qa(g))||g===PS.DEFAULT)g=y;else if(g===PS.CURRENT)g=Aa;else{if("number"!==e)return ub(d+"delay argument invalid");(g=Math.floor(g))<1&&(g=1)}return ya=f,Ba=h,Aa=g,{repeat:ya,init:Ba,delay:Aa}},date:function(){return Od()},elapsed:function(){var a;return a=new Date,a.getTime()-I.date.time},imageLoad:function(a,b,c){var d,e,f,g,h,i,j,k,m;if(d="[PS.imageLoad] ",(e=arguments.length)<2)return ub(d+"Missing argument(s)");if(e>3)return ub(d+"Too many argument(s)");if(f=a,g=b,h=c,"string"!=typeof f||f.length<1)return ub(d+"filename argument invalid");if(i=f.substr(f.lastIndexOf(".")+1),"png"!==(i=i.toLowerCase())&&"jpg"!==i&&"jpeg"!==i&&"bmp"!==i)return ub(d+"filename extension invalid");if("function"!=typeof g)return ub(d+"exec argument invalid");if("undefined"===(m=Qa(h))||h===PS.DEFAULT)h=4;else{if("number"!==m)return ub(d+"format argument invalid");if((h=Math.floor(h))<1&&h>4)return ub(d+"format argument is not 1, 2, 3 or 4")}k=l+ba,ba+=1,aa.push({source:f,id:k,exec:g,format:h});try{j=new Image,j.setAttribute("data-id",k),j.onload=function(){ld(j)},j.onerror=function(){jd(j)},j.src=f}catch(a){return tb(d+"Error loading "+f+" ["+a.message+"]",a)}return k},imageBlit:function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q;if(e="[PS.imageBlit] ",(f=arguments.length)<3)return ub(e+"Missing argument(s)");if(f>4)return ub(e+"Too many arguments");if(g=U.x,h=U.y,i=a,j=b,k=c,l=d,md(e,i)===PS.ERROR)return PS.ERROR;if(m=i.width,n=i.height,o=i.pixelSize,p=i.data,"undefined"===(q=Qa(j))||j===PS.DEFAULT)j=0;else{if("number"!==q)return ub(e+"xpos argument invalid");j=Math.floor(j)}if("undefined"===(q=Qa(k))||k===PS.DEFAULT)k=0;else{if("number"!==q)return ub(e+"ypos argument invalid");k=Math.floor(k)}if(j>=g||k>=h||j+m<1||k+n<1)return!1;if("undefined"===(q=Qa(l))||l===PS.DEFAULT)r=0,s=0,t=m,w=n;else{if("object"!==q)return ub(e+"region argument invalid");if(s=l.left,"undefined"===(q=Qa(s))||s===PS.DEFAULT)s=0;else{if("number"!==q)return ub(e+"region.left invalid");if((s=Math.floor(s))<0)s=0;else if(s>=m)return ub(e+"region.left outside image")}if(r=l.top,"undefined"===(q=Qa(r))||r===PS.DEFAULT)r=0;else{if("number"!==q)return ub(e+"region.top invalid");if((r=Math.floor(r))<0)r=0;else if(r>=n)return ub(e+"region.top outside image")}if(t=l.width,"undefined"===(q=Qa(t))||t===PS.DEFAULT)t=m-s;else{if("number"!==q)return ub(e+"region.width invalid");if((t=Math.floor(t))<1)return!1;s+t>m&&(t=m-s)}if(j+t<1)return!1;if(w=l.height,"undefined"===(q=Qa(w))||w===PS.DEFAULT)w=n-r;else{if("number"!==q)return ub(e+"region.height invalid");if((w=Math.floor(w))<1)return!1;r+w>n&&(w=n-r)}if(k+w<1)return!1}if(j<0){if((t+=j)<1)return!1;s-=j,j=0}if(y=j+t,y>g&&(t=g-j),t<1)return!1;if(k<0){if((w+=k)<1)return!1;r-=k,k=0}if(y=k+w,y>h&&(w=h-k),w<1)return!1;for(z=m*o,Q=!1,J=255,x=U.plane,A=r*z+s*o,D=k,E=0;E<w;E+=1){for(B=A,C=j,F=0;F<t;F+=1)N=C+D*g,O=V[N],O.active&&(Q=!0,o<3?(K=p[B],G=K/u,G=Math.floor(G),L=G*u,H=(K-L)/v,H=Math.floor(H),M=H*v,I=K-L-M,2===o&&(J=p[B+1])):(G=p[B],H=p[B+1],I=p[B+2],K=G*u+H*v+I,4===o&&(J=p[B+3])),P=Pb(O,x),P.r=G,P.g=H,P.b=I,P.a=J,P.rgb=K,Ib(O)),C+=1,B+=o;D+=1,A+=z}return Q&&kb(),!0},imageCapture:function(a,b){var c,e,f,g,h,i,j,k,m,n,o,p,q,r,s,t,u,v,w,x,y,z;if(c="[PS.imageCapture] ",arguments.length>2)return ub(c+"Too many arguments");if(e=a,f=b,"undefined"===(g=Qa(e))||e===PS.DEFAULT)e=3;else{if("number"!==g)return ub(c+"format argument invalid");if((e=Math.floor(e))<1&&e>4)return ub(c+"format argument is not 1, 2, 3 or 4")}if(h=U.x,i=U.y,"undefined"===(g=Qa(f))||f===PS.DEFAULT)k=0,m=0,n=h,o=i;else{if("object"!==g)return ub(c+"region argument invalid");if(m=f.left,"undefined"===(g=Qa(m))||m===PS.DEFAULT)m=0;else{if("number"!==g)return ub(c+"region.left not a number");if((m=Math.floor(m))<0)m=0;else if(m>=h)return ub(c+"region.left outside grid")}if(k=f.top,"undefined"===(g=Qa(k))||k===PS.DEFAULT)k=0;else{if("number"!==g)return ub(c+"region.top not a number");if((k=Math.floor(k))<0)k=0;else if(k>=i)return ub(c+"region.top outside grid")}if(n=f.width,"undefined"===(g=Qa(n))||n===PS.DEFAULT)n=h-m;else{if("number"!==g)return ub(c+"region.width not a number");n=Math.floor(n),(n<1||m+n>h)&&(n=h-m)}if(o=f.height,"undefined"===(g=Qa(o))||o===PS.DEFAULT)o=i-k;else{if("number"!==g)return ub(c+"region.height not a number");o=Math.floor(o),(o<1||k+o>i)&&(o=i-k)}}if(t=l+ba,ba+=1,q={source:PS.GRID,id:t,width:n,height:o,pixelSize:e,valid:!0,data:[]},(p=n*o)<1)return q;for(j=q.data,j.length=p*e,r=m+n,s=k+o,u=0,w=k;w<s;w+=1)for(v=m;v<r;v+=1)x=v+w*h,y=V[x],z=y.color,e<3?(j[u]=z.rgb,2===e&&(j[u+1]=z.a)):(j[u]=z.r,j[u+1]=z.g,j[u+2]=z.b,4===e&&(j[u+3]=z.a)),u+=e;return q},imageDump:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;if(f="[PS.imageDump] ",(g=arguments.length)<1)return ub(f+"Missing argument(s)");if(g>5)return ub(f+"Too many arguments");if(h=a,i=b,j=c,k=d,md(f,h)===PS.ERROR)return PS.ERROR;if(m=h.width,n=h.height,o=h.pixelSize,p=h.data,"undefined"===(q=Qa(i))||i===PS.DEFAULT)r=0,s=0,t=m,w=n;else{if("object"!==q)return ub(f+"region argument invalid");if(s=i.left,"undefined"===(q=Qa(s))||s===PS.DEFAULT)s=0;else{if("number"!==q)return ub(f+"region.left invalid");if((s=Math.floor(s))<0)s=0;else if(s>=m)return ub(f+"region.left outside grid")}if(r=i.top,"undefined"===(q=Qa(r))||r===PS.DEFAULT)r=0;else{if("number"!==q)return ub(f+"region.top invalid");if((r=Math.floor(r))<0)r=0;else if(r>=n)return ub(f+"region.top outside grid")}if(t=i.width,"undefined"===(q=Qa(t))||t===PS.DEFAULT)t=m-s;else{if("number"!==q)return ub(f+"region.width invalid");t=Math.floor(t),(t<1||s+t>m)&&(t=m-s)}if(w=i.height,"undefined"===(q=Qa(w))||w===PS.DEFAULT)w=n-r;else{if("number"!==q)return ub(f+"region.height invalid");w=Math.floor(w),(w<1||r+w>n)&&(w=n-r)}}if(x=t*w,"undefined"===(q=Qa(j))||j===PS.DEFAULT)j=o;else{if("number"!==q)return ub(f+"format argument invalid");if((j=Math.floor(j))<1||j>4)return ub(f+"format argument is not 1, 2, 3 or 4")}if("undefined"===(q=Qa(k))||k===PS.DEFAULT)k=t;else{if("number"!==q)return ub(f+"length argument invalid");k=Math.floor(k),k<1&&(k=1),k>x&&(k=x)}if((l=Sa(e,PS.ERROR,!0,!0))===PS.ERROR)return ub(f+"hex argument invalid");if(y="\nvar myImage = {\n\twidth : "+t+", height : "+w+", pixelSize : "+j+",\n\tdata : [",x<1)return y+="]\n};\n",PS.debug(y),PS.DONE;for(y+="\n\t",C=255,B=A=0,z=m*o,D=r*z+s*o,F=0;F<w;F+=1){for(E=D,G=0;G<t;G+=1)o<3?(K=p[E],K<1?H=I=J=0:K>=16777215?H=I=J=255:(H=K/u,H=Math.floor(H),L=H*u,I=(K-L)/v,I=Math.floor(I),M=I*v,J=K-L-M),2===o&&(C=p[E+1])):(H=p[E],I=p[E+1],J=p[E+2],K=H*u+I*v+J,4===o&&(C=p[E+3])),y+=od(j,l,K,H,I,J,C),B+=1,B<x&&(y+=",",A+=1,A<k?y+=" ":(A=0,y+="\n\t")),E+=o;D+=z}return y+="\n\t]\n};\n",PS.debug(y),PS.DONE},spriteSolid:function(a,b){var c,d,e,f,g;if(c="[PS.spriteSolid] ",(d=arguments.length)<2)return ub(c+"Missing argument(s)");if(d>2)return ub(c+"Too many argument(s)");if(e=a,f=b,e===PS.DEFAULT)e=1;else{if("number"!==Qa(e))return ub(c+"width argument invalid");(e=Math.floor(e))<1&&(e=1)}if(f===PS.DEFAULT)f=1;else{if("number"!==Qa(f))return ub(c+"height argument invalid");(f=Math.floor(f))<1&&(f=1)}return g=pd(),g.width=e,g.height=f,g.color={rgb:0,r:0,g:0,b:0,a:255},g.id},spriteSolidColor:function(a,b,c,d){var e,f,g,h,i,j,k,l,m;return e="[PS.spriteSolidColor] ",(f=arguments.length)<1?ub(e+"Missing argument(s)"):f>4?ub(e+"Too many argument(s)"):(g=qd(a,e))===PS.ERROR?PS.ERROR:(i=g.color)?(h=Mb(e,b,c,d))===PS.ERROR?PS.ERROR:(j=h.rgb,j!==PS.CURRENT&&(null===j?(k=h.r,k===PS.CURRENT?h.r=k=i.r:k===PS.DEFAULT&&(h.r=k=0),l=h.g,l===PS.CURRENT?h.g=l=i.g:l===PS.DEFAULT&&(h.g=l=0),m=h.b,m===PS.CURRENT?h.b=m=i.b:m===PS.DEFAULT&&(h.b=m=0),h.rgb=j=k*u+l*v+m):j===PS.DEFAULT&&(h.rgb=j=0,h.r=0,h.g=0,h.b=0),i.rgb!==j&&(i.rgb=j,i.r=h.r,i.g=h.g,i.b=h.b,g.visible&&g.placed&&(sd(g),kb()))),i.rgb):ub(e+"Cannot set color of image sprite "+g.id)},spriteSolidAlpha:function(a,b){var c,d,e,f,g,h,i;if(c="[PS.spriteSolidAlpha] ",(d=arguments.length)<1)return ub(c+"Missing argument(s)");if(d>2)return ub(c+"Too many argument(s)");if(e=a,f=b,(g=qd(e,c))===PS.ERROR)return PS.ERROR;if(!(h=g.color))return ub(c+"Cannot set alpha of image sprite "+g.id);if("undefined"!==(i=Qa(f))&&f!==PS.CURRENT){if(f===PS.DEFAULT)f=255;else{if("number"!==i)return ub(c+"alpha argument invalid");f=Math.floor(f),f<0?f=0:f>255&&(f=255)}h.a!==f&&(h.a=f,g.visible&&g.placed&&(sd(g),kb()))}return h.a},spriteImage:function(a,b){var c,d,e,f,g,h,i,j,k,m,n,o,p,q,r,s,t,w,x,y,z,A,B,C,D,E;if(c="[PS.spriteImage] ",(d=arguments.length)<1)return ub(c+"Missing argument(s)");if(d>2)return ub(c+"Too many argument(s)");if(md(c,a)===PS.ERROR)return PS.ERROR;if(k=j=0,m=e=a.width,n=f=a.height,g=a.pixelSize,h=a.data,"undefined"!==(i=Qa(b))&&b!==PS.DEFAULT){if("object"!==i)return ub(c+"region argument invalid");if(k=b.left,"undefined"===(i=Qa(k))||k===PS.DEFAULT)k=0;else{if("number"!==i)return ub(c+"region.left invalid");if((k=Math.floor(k))<0)k=0;else if(k>=e)return ub(c+"region.left outside image")}if(j=b.top,"undefined"===(i=Qa(j))||j===PS.DEFAULT)j=0;else{if("number"!==i)return ub(c+"region.top invalid");if((j=Math.floor(j))<0)j=0;else if(j>=f)return ub(c+"region.top outside image")}if(m=b.width,"undefined"===(i=Qa(m))||m===PS.DEFAULT)m=e-k;else{if("number"!==i)return ub(c+"region.width invalid");m=Math.floor(m),(m<1||k+m>e)&&(m=e-k)}if(n=b.height,"undefined"===(i=Qa(n))||n===PS.DEFAULT)n=f-j;else{if("number"!==i)return ub(c+"region.height invalid");n=Math.floor(n),(n<1||j+n>f)&&(n=f-j)}}for(o=[],o.length=m*n*4,B=255,p=e*g,q=j*p+k*g,w=0,t=0;t<n;t+=1){for(r=q,s=0;s<m;s+=1)g<3?(x=h[r],x<1?x=y=z=A=0:x>=16777215?(x=16777215,y=z=A=255):(y=x/u,y=Math.floor(y),C=y*u,z=(x-C)/v,z=Math.floor(z),D=z*v,A=x-C-D),2===g&&(B=h[r+1])):(y=h[r],z=h[r+1],A=h[r+2],4===g&&(B=h[r+3])),o[w]=y,o[w+1]=z,o[w+2]=A,o[w+3]=B,r+=g,w+=4;q+=p}return E=pd(),E.width=m,E.height=n,E.image={id:l+ba,width:m,height:n,pixelSize:4,data:o},ba+=1,E.id},spriteShow:function(a,b){var c,d,e,f,g;return c="[PS.spriteShow] ",(d=arguments.length)<1?ub(c+"Missing argument(s)"):d>2?ub(c+"Too many argument(s)"):(e=a,(g=qd(e,c))===PS.ERROR?PS.ERROR:(f=Sa(b,PS.CURRENT,!0,PS.CURRENT))===PS.ERROR?ub(c+"show argument invalid"):(f!==PS.CURRENT&&g.visible!==f&&(g.visible=f,g.placed&&(f?(sd(g),td(g,e)):rd(g),kb())),g.visible))},spriteAxis:function(a,b,c){var d,e,f,g,h,i,j;if(d="[PS.spriteAxis] ",(e=arguments.length)<1)return ub(d+"Missing argument(s)");if(e>3)return ub(d+"Too many argument(s)");if(f=a,g=b,h=c,(i=qd(f,d))===PS.ERROR)return PS.ERROR;if("undefined"===(j=Qa(g))||g===PS.CURRENT)g=i.ax;else if(g===PS.DEFAULT)g=0;else{if("number"!==j)return ub(d+"x argument invalid");g=Math.floor(g)}if("undefined"===(j=Qa(h))||h===PS.CURRENT)h=i.ay;else if(h===PS.DEFAULT)h=0;else{if("number"!==j)return ub(d+"y argument invalid");h=Math.floor(h)}return g===i.ax&&h===i.ay||(i.ax=g,i.ay=h,i.visible&&i.placed&&(sd(i),td(i,f),kb())),{x:i.ax,y:i.ay}},spritePlane:function(a,b){var c,d,e,f,g,h;if(c="[PS.spritePlane] ",(d=arguments.length)<1)return ub(c+"Missing argument(s)");if(d>2)return ub(c+"Too many arguments");if(e=a,f=b,(g=qd(e,c))===PS.ERROR)return PS.ERROR;if("undefined"!==(h=Qa(f))&&f!==PS.CURRENT){if(f===PS.DEFAULT)f=0;else{if("number"!==h)return ub(c+"plane argument invalid");(f=Math.floor(f))<1&&(f=0)}g.plane!==f&&(g.visible&&g.placed&&rd(g),g.plane=f,g.visible&&g.placed&&(sd(g),kb()))}return g.plane<0?0:g.plane},spriteMove:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(d="[PS.spriteMove] ",(e=arguments.length)<1)return ub(d+"Missing argument(s)");if(e>3)return ub(d+"Too many argument(s)");if(f=a,g=b,h=c,(i=qd(f,d))===PS.ERROR)return PS.ERROR;if("undefined"===(j=Qa(g))||g===PS.CURRENT)g=i.x;else if(g===PS.DEFAULT)g=0;else{if("number"!==j)return ub(d+"x argument invalid");g=Math.floor(g)}if("undefined"===(j=Qa(h))||h===PS.CURRENT)h=i.y;else if(h===PS.DEFAULT)h=0;else{if("number"!==j)return ub(d+"y argument invalid");h=Math.floor(h)}return i.placed&&g===i.x&&h===i.y||(s=!1,i.plane<0&&(i.plane=U.plane),i.visible&&i.placed&&(l=i.y,n=i.height,g>i.x?(m=g-i.x,k=i.x):i.x>g?(m=i.x-g,k=i.x+i.width-m):m=0,m>=i.width?(s=!0,rd(i)):(o=i.x,q=i.width,h>i.y?(r=h-i.y,p=i.y):i.y>h?(r=i.y-h,p=i.y+i.height-r):r=0,r>=i.height?(s=!0,rd(i)):r<1?(s=!0,rd(i,k,l,m,n)):q<1?(s=!0,rd(i,o,p,q,r)):(s=!0,q-=m,g>i.x&&(o+=m),rd(i,k,l,m,n),rd(i,o,p,q,r)))),i.x=g,i.y=h,i.placed=!0,i.visible&&(s=!0,sd(i),td(i,f)),s&&kb()),{x:i.x,y:i.y}},spriteCollide:function(a,b){var c,d,e,f,g;if(c="[PS.spriteCollide] ",(d=arguments.length)<1)return ub(c+"Missing argument(s)");if(d>2)return ub(c+"Too many arguments");if((e=qd(a,c))===PS.ERROR)return PS.ERROR;if(f=b,"undefined"!==(g=Qa(f))&&f!==PS.CURRENT){if(f===PS.DEFAULT)f=null;else if("function"!==g)return ub(c+"exec argument not a function");e.collide!==f&&(e.collide=f,f&&e.visible&&e.placed&&td(e,a))}return e.collide},spriteDelete:function(a){var b,c,d,e,f;if(b="[PS.spriteDelete] ",(c=arguments.length)<1)return ub(b+"Missing argument");if(c>1)return ub(b+"Too many arguments");if("string"!=typeof a||a.length<1)return ub(b+"sprite argument invalid");for(d=ca.length,e=0;e<d;e+=1)if(f=ca[e],f.id===a)return rd(f),ca.splice(e,1),kb(),PS.DONE;return ub(b+"sprite id '"+a+"' not found")},audioLoad:function(a,b){var c,d;return c="[PS.audioLoad] ",arguments.length<1?ub(c+"Missing argument(s)"):arguments.length>2?ub(c+"Too many arguments"):(d=AQ.load(a,b),d===AQ.ERROR?PS.ERROR:d)},audioPlay:function(a,b){var c,d,e,f,g,h;if(c="[PS.audioPlay] ",(d=arguments.length)<1)return ub(c+"Missing argument(s)");if(d>2)return ub(c+"Too many arguments");if(e=a,f=b,"undefined"===(g=Qa(f)))f={};else if("object"!==g)return ub(c+"params argument invalid");return f.autoplay=!0,h=AQ.load(e,f),h===AQ.ERROR?PS.ERROR:h},audioPause:function(a){var b,c,d;return b="[PS.audioPause] ",(c=arguments.length)<1?ub(b+"Missing argument(s)"):c>1?ub(b+"Too many arguments"):(d=AQ.pause(a),d===AQ.ERROR?PS.ERROR:d)},audioStop:function(a){var b,c,d;return b="[PS.audioStop] ",(c=arguments.length)<1?ub(b+"Missing argument(s)"):c>1?ub(b+"Too many arguments"):(d=AQ.stop(a),d===AQ.ERROR?PS.ERROR:d===AQ.DONE?PS.DONE:d)},piano:function(a,b){var c,d,e,f,g,h;if(c="[PS.piano] ",d=E.length,f=a,"number"!==(e=Qa(f)))return ub(c+"index argument invalid");if(f=Math.floor(f),f<1?f=1:f>d&&(f=d),!0!==(g=b)&&!1!==g)if("undefined"===(e=Qa(g)))g=!1;else if("number"!==e)return ub(c+"flag argument invalid");return h="piano_"+E[f-1],g&&(h="l_"+h),h},harpsichord:function(a,b){var c,d,e,f,g,h;if(c="[PS.harpsichord] ",d=F.length,f=a,"number"!==(e=Qa(f)))return ub(c+"index argument invalid");if(f=Math.floor(f),f<1?f=1:f>d&&(f=d),!0!==(g=b)&&!1!==g)if("undefined"===(e=Qa(g)))g=!1;else if("number"!==e)return ub(c+"flag argument invalid");return h="hchord_"+F[f-1],g&&(h="l_"+h),h},xylophone:function(a){var b,c,e;return b="[PS.xylophone] ",c=G.length,e=a,"number"!==Qa(e)?ub(b+"index argument invalid"):(e=Math.floor(e),e<1?e=1:e>c&&(e=c),"xylo_"+G[e-1])},debug:function(a){var b,c,d,e;return b="[PS.debug] ",arguments.length>1?ub(b+"Too many arguments"):(c=a,d=Qa(c),"undefined"===d?c="":"string"!==d&&(c=c.toString()),lb(),c.length>0&&(e=document.getElementById(k),e.value+=c,e.scrollTop=e.scrollHeight,console&&console.log&&console.log(c)),vb(),PS.DONE)},debugClose:function(){var a,b;return a="[PS.debugClose] ",arguments.length>0?ub(a+"Too many arguments"):(b=document.getElementById(j),b.style.display="none",Ka=!1,PS.DONE)},debugClear:function(){var a;return a="[PS.debugClear] ",arguments.length>0?ub(a+"Too many arguments"):(Ja.value="",PS.DONE)},line:function(a,b,c,d){var e,f,g,h,i,j;return e="[PS.line] ",(f=arguments.length)<4?ub(e+"Missing argument(s)"):f>4?ub(e+"Too many arguments"):(g=a,h=b,i=c,j=d,"number"!==Qa(g)?ub(e+"x1 argument not a number"):(g=Math.floor(g),"number"!==Qa(h)?ub(e+"y1 argument not a number"):(h=Math.floor(h),"number"!==Qa(i)?ub(e+"x2 argument not a number"):(i=Math.floor(i),"number"!==Qa(j)?ub(e+"y2 argument not a number"):(j=Math.floor(j),vd(g,h,i,j))))))},pathMap:function(a){var b,c,d;return b="[PS.pathMap] ",(c=arguments.length)<1?ub(b+"Missing argument(s)"):c>1?ub(b+"Too many arguments"):md(b,a)===PS.ERROR?PS.ERROR:1!==a.pixelSize?ub(b+"image is not format 1"):(d=Cd(a.width,a.height,a.data),d.id)},pathFind:function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,r,s,t;if(g="[PS.pathFind] ",(h=arguments.length)<5)return ub(g+"Missing argument(s)");if(h>6)return ub(g+"Too many arguments");if(i=a,j=b,k=c,l=d,m=e,n=f,!i||"string"!=typeof i||i.length<1)return ub(g+"pathmap argument invalid");if(!(o=Dd(i)))return ub(g+i+" not found");if("number"!==Qa(j))return ub(g+"x1 argument not a number");if((j=Math.floor(j))<0||j>=o.width)return ub(g+"x1 argument is outside "+i);if("number"!==Qa(k))return ub(g+"y1 argument not a number");if((k=Math.floor(k))<0||k>=o.height)return ub(g+"y1 argument is outside "+i);if("number"!==Qa(l))return ub(g+"x2 argument not a number");if((l=Math.floor(l))<0||l>=o.width)return ub(g+"x2 argument is outside "+i);if("number"!==Qa(m))return ub(g+"y2 argument not a number");if((m=Math.floor(m))<0||m>=o.height)return ub(g+"y2 argument is outside "+i);if(s=!1,t=!1,"undefined"!==(p=Qa(n))&&n!==PS.DEFAULT){if("object"!==p)return ub(g+"options argument invalid");if(!0===(r=n.no_diagonals)||!1===r)s=r;else if("undefined"===(p=Qa(r))||r===PS.DEFAULT)s=!1;else{if("number"!==p)return ub(g+"options.no_diagonals invalid");s=0!==r}if(!0===(r=n.cut_corners)||!1===r)t=r;else if("undefined"===(p=Qa(r))||r===PS.DEFAULT)t=!1;else{if("number"!==p)return ub(g+"options.cut_corners invalid");t=0!==r}}return Ad(o,j,k,l,m,s,t)},pathData:function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q;if(g="[PS.pathData] ",(h=arguments.length)<5)return ub(g+"Missing argument(s)");if(h>6)return ub(g+"Too many arguments");if(i=a,j=b,k=c,l=d,m=e,n=f,!i||"string"!=typeof i||i.length<1)return ub(g+"pathmap argument invalid");if(!(o=Dd(i)))return ub(g+i+" not found");if("number"!==Qa(j))return ub(g+"left argument not a number");if((j=Math.floor(j))<0||j>=o.width)return ub(g+"left argument is outside "+i);if("number"!==Qa(k))return ub(g+"top argument not a number");if((k=Math.floor(k))<0||k>=o.height)return ub(g+"top argument is outside "+i);if(l===PS.DEFAULT)l=1;else{if("number"!==Qa(l))return ub(g+"width argument not a number");l=Math.floor(l),l<1?l=1:(p=o.width-j,l>p&&(l=p))}if(m===PS.DEFAULT)m=1;else{if("number"!==Qa(m))return ub(g+"height argument not a number");m=Math.floor(m),m<1?m=1:(p=o.height-k,m>p&&(m=p))}if(n!==PS.DEFAULT&&n!==PS.CURRENT)if("undefined"===(q=Qa(n)))n=PS.CURRENT;else{if("number"!==q)return ub(g+"data argument not a number");if(n<0)return ub(g+"data argument < 0")}return Bd(o,j,k,l,m,n)},pathDelete:function(a){var b,c;return b="[PS.pathDelete] ",c=arguments.length,c<1?ub(b+"Missing argument"):!a||"string"!=typeof a||a.length<1?ub(b+"pathmap argument invalid"):Ed(a)?PS.DONE:ub(b+a+" not found")},pathNear:function(a,b,c,d,e){var f,g,h;return f="[PS.pathNear] ",(g=arguments.length)<5?ub(f+"Missing argument(s)"):g>5?ub(f+"Too many arguments"):!a||"string"!=typeof a||a.length<1?ub(f+"pathmap argument invalid"):(h=Dd(a))?Fd(h,b,c,d,e):ub(f+a+" not found")},dbInit:function(a,b){var c,d,e,f,g,h,i,j;if(c="[PS.dbInit] ",(d=arguments.length)<1)return ub(c+"Missing argument(s)");if(d>2)return ub(c+"Too many arguments");if(!a||"string"!=typeof a||a.length<1)return ub(c+"Database id invalid");if((e=a.toLowerCase())===Pd.TIME_LABEL)return ub(c+"Database id '"+Pd.TIME_LABEL+"' is reserved");if(Pd.validID(e))return ub(c+"Database id '"+e+"' already exists");if(h=!1,j=null,f=function(a){var b,d;if(!a||"string"!=typeof a||a.length<1?(Gb("WARNING: Invalid user ID"),d=Pd.init(e,null,h)):(b=a.toLowerCase(),K.PS.USERS[b]?d=Pd.init(e,b,h):(Gb("WARNING: Unauthorized user ID"),d=Pd.init(e,null,h))),j&&"function"==typeof j)try{j(d)}catch(a){return tb(c+"Callback function failed ["+a.message+"]",a)}return d},g=function(a){var b;return b=PS.statusInput("User ID:",f),b===PS.ERROR?PS.ERROR:a},K&&b&&b!==PS.DEFAULT){if(Ra(b)!==PS.ERROR)return i=PS.statusInput("User ID:",f),i===PS.ERROR?PS.ERROR:e;if("object"!==Qa(b))return ub(c+"options parameter invalid");if((i=b.discard)!==PS.DEFAULT&&(h=Ra(b.discard))===PS.ERROR)return ub(c+"options.discard property is not a Boolean");if((i=b.login)!==PS.DEFAULT){if(j=b.login,(i=Ra(j))===PS.ERROR)return"function"==typeof j?g(e):ub(c+"options.login property is not a boolean or function");if(i)return j=null,g(e)}}return Pd.init(e,null,h)},dbValid:function(a){return Pd.validID(a)},dbErase:function(a){var b,c,d;return b="[PS.dbErase] ",(c=arguments.length)<1?ub(b+"Missing argument"):c>1?ub(b+"Too many arguments"):!a||"string"!=typeof a||a.length<1?ub(b+"Database id invalid"):(d=a.toLowerCase(),Pd.validID(d)?(Pd.erase(d),d):ub(b+"Database id '"+d+"' does not exist"))},dbEvent:function(a){var b,c,d,e,f,g,h,i,j,k;if(b="[PS.dbEvent] ",(c=arguments.length)<3)return ub(b+"Missing arguments");if(!a||"string"!=typeof a||a.length<1)return ub(b+"Database id invalid");if(d=a.toLowerCase(),!Pd.validID(d))return ub(b+"Database id '"+d+"' does not exist");for(f={},g=[],e=1;e<c;){if(!(h=arguments[e])||"string"!=typeof h||h.length<1)return ub(b+"Event name @ argument "+e+" invalid");if((h=h.toLowerCase())===Pd.TIME_LABEL)return ub(b+"Event label '"+Pd.TIME_LABEL+"' is reserved");if(f.hasOwnProperty(h))return ub(b+"Duplicate event '"+h+"' @ argument "+e);if(f[h]=!0,(i=e+1)>=c)return ub(b+"Missing value for event '"+h+"'");if(g.push(h),j=arguments[i],"number"!==(k=Qa(j))&&"string"!==k&&!0!==j&&!1!==j&&null!==j)return ub(b+"Illegal value type for event '"+h+"'");g.push(j),e+=2}return Pd.event(d,g)},dbData:function(a){var b,c;return b="[PS.dbData] ",(c=arguments.length)<1?ub(b+"Missing argument"):c>1?ub(b+"Too many arguments"):!a||"string"!=typeof a||a.length<1?ub(b+"Database id invalid"):(a=a.toLowerCase(),Pd.validID(a)?Pd.store[a]:ub(b+"Database id '"+a+"' does not exist"))},dbDump:function(a){var b,c,d;return b="[PS.dbDump] ",(c=arguments.length)<1?ub(b+"Missing argument"):c>1?ub(b+"Too many arguments"):!a||"string"!=typeof a||a.length<1?ub(b+"Database id invalid"):(a=a.toLowerCase(),Pd.validID(a)?(d=Pd.csv(b,a))===PS.ERROR?d:(PS.debug(d),a):ub(b+"Database id '"+a+"' does not exist"))},dbSend:function(a,b,c){var d,e,f,g,h,i,j,k,l;if(d="[PS.dbSend] ",(e=arguments.length)<2)return ub(d+"Missing argument(s)");if(e>3)return ub(d+"Too many arguments");if(!K)return ub(d+"Knecht server unavailable");if(!a||"string"!=typeof a||a.length<1)return ub(d+"Database id invalid");if(f=a.toLowerCase(),!Pd.validID(f))return ub(d+"Database id '"+f+"' does not exist");if("string"===(g=Qa(b))){if(b.length<1)return ub(d+"Username string is empty");if(h=b.toLowerCase(),!K.PS.USERS[h])return ub(d+"Unauthorized user id '"+h+"'");l=h,k=[K.PS.addSuffix(h)]}else{if("array"!==g)return ub(d+"Username argument is not a string or array");if((i=b.length)<1)return ub(d+"Username array is empty");for(k=[],j=0;j<i;j+=1){if(!(h=b[j])||"string"!=typeof h||h.length<1)return ub(d+"username["+j+"] not a valid string");if(h=h.toLowerCase(),!K.PS.USERS[h])return ub(d+"Unauthorized user id @ username["+j+"]: '"+h+"'");j||(l=h),k.push(K.PS.addSuffix(h))}}if(c){if("object"!==Qa(c))return ub(d+"Options argument is not an object");if((h=c.message)&&h!==PS.DEFAULT){if("string"!=typeof h)return ub(d+"options.message is not a valid string")}else c.message="Sending database '"+f+"' ...";if(!0!==(h=c.discard)&&!1!==h){if(void 0===h||null===h||h===PS.DEFAULT)c.discard=!1;else if("number"!==Qa(h))return ub(d+"options.discard invalid");c.discard=0!==h}}return Pd.emails(d,f,k,l,c)},_footerText:function(a){var b,c,d;return b="[PS._footerText] ",arguments.length>1?ub(b+"Too many arguments"):(c=a,d=Qa(c),c!==PS.CURRENT&&"undefined"!==d&&(c===PS.DEFAULT?c="":"string"!==d&&(c=c.toString()),rb(),sb(c)),la)}}}(),function(){"use strict";var a,b,c,d;for(a=0,b=["webkit","moz","ms","o"],c=0;c<b.length&&!window.requestAnimationFrame;c+=1)d=b[c],window.requestAnimationFrame=window[d+"RequestAnimationFrame"],window.cancelAnimationFrame=window[d+"CancelAnimationFrame"]||window[d+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c,d,e;return c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d),a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){window.clearTimeout(a)})}();
